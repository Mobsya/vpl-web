<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="viewport" content="width=device-width, height=device-height, maximum-scale=1, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />

<!-- definition of the user interface and blocks -->
<script type="application/json" id="ui.json">
{
	"hardcoded-gui": true,
	"blocks": null,
	"buttons": null,
	"widgets": null,

	"css": [
		"classic.css"
	],

	"fragments": {
		"about.html": "<iframe src=\"vpl-about.html\" style=\"width:100%;height:100%;border:none;\"></iframe>",
		"vpl-export-html.css": "td.events, td.then, td.actions {\n\tborder: solid 2px silver;\n\tborder-style: solid none;\n}\ntd.block {\n\tpadding: 15px;\n}\ntd.events {\n    min-width: 20px;\n    border-left-style: solid;\n    border-top-left-radius: 20px; \n    border-bottom-left-radius: 20px;\n}\ntd.event-aux {    transform: scale(0.8) translate(0,10px);\n}\ntd.actions {\n    min-width: 20px;\n    border-right-style: solid;\n    border-bottom-right-radius: 20px; \n    border-top-right-radius: 20px; \n}\ntable.program {\n\tborder-collapse: separate;\n\tborder-spacing: 0 10px;\n\tmargin-left: auto;\n\tmargin-right: auto;\n}\n"
	},

	"overlays": [
		"aseba.json",
		"l2.json",
		"js.json",
		"python.json",

		"typical-param-set.json",
		"typical-states.json",

		"block-english.json",
		"cmd-vpl-english.json",
		"cmd-sim-english.json",
		"french.json",
		"block-french.json",
		"cmd-vpl-french.json",
		"cmd-sim-french.json"
	]
}
</script>

<script type="text/x-vpl-css" id="classic.css">
/*
	CSS for VPL3 application
    Classic version (blocks, buttons and widgets defined in JavaScript)
	Copyright 2019-2020, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE
*/

view {
	background: white;
}

toolbar {
	padding: 5px;
	margin: 0;
}
toolbar.top {
	border-bottom: 1px silver;
}
toolbar.bottom {
	border-top: 1px silver;
	border-left: 1px silver;
	border-right: 1px silver;
}

button {
	width: 3.0ww;
	height: 3.0ww;
	min-width: 20px;
	min-height: 20px;
	margin: 0.2vw;
}

#vpl-close, #src-close, #sim-close {
	width: 1.5ww;
	min-width: 10px;
}

button.vpl.bottom {
	font: max(1.7vw, 12px) sans-serif;
}

#vpl-message-error {
	color: #e44;
	width: 20vw;
}

#vpl-message-warning {
	color: #f88;
	width: 20vw;
}

#vpl-filename {
	width: 9ww;
	font: max(1vw, 12px) sans-serif;
}

separator {
	width: 5px;
	height: 5px;
}

vpl {
	padding: 5px;
	margin: 5px;
	background: #eee;
}

block {
	width: 6vw;
	height: 6vw;
	min-width: 32px;
	min-height: 32px;
}

block.library {
	margin: 4px;
}

block.event {
	background: #f70;
	border: none #f70;
}
block.event-aux, block.state {
	width: 5vw;
	height: 5vw;
	min-width: 27px;
	min-height: 27px;
	vertical-align: bottom;
}
block.action {
	background: #38f;
	border: none #38f;
}
block.state {
	background: #0c0;
	border: none #0c0;
}
block.comment {
	background: #aaa;
	border: none #aaa;
}
block.empty {
	border-width: 2px;
	background: transparent;
	width: 1.5vw;
	min-width: 8px;
}
block.empty.event-aux {
	height: 5vw;
	min-height: 27px;
	vertical-align: bottom;
}
block.empty:only-child {
	width: 6vw;
	min-width: 32px;
}

block-container {
	padding: 0;
	padding-bottom: 0.4vw;
	margin: 0.6vw;
	margin-bottom: 0.2vw;
	border-bottom: transparent 3px;
}

block-container.error {
	border-bottom: #e44 3px;
}
block-container.warning {
	border-bottom: #f88 3px;
}

rule {
	background: #ddd;
	border: solid #666;
	border-radius: 0.6vw;
	padding: 0.3vw;
	margin:0.6vw;
}

rule:small {
	background: white;
}

overlay-rectangle.disabled {
	background: rgba(255,255,255,0.5);
}

overlay-rectangle.drop-target {
	border: 0.2vw rgba(0,0,0,0.5);
	border-radius: 0.2vw;
}

crossout-line {
	line-width: 0.75vw;
 	color: rgba(120,120,120,0.5);
}
crossout-line.vpl {
	line-width: 5vw;
}

widget {
	width: 3vw;
	height: 3vw;
}

#widget-error, #widget-warning {
	width: 3vw;
	height: 3vw;
	padding: 0.2vw;
	margin-right: 0.8vw;
}

conflict-line.error {
	line: 3px #e44 dashed;
}
conflict-line.warning {
	line: 3px #f88;
}

#widget-then {
	width: 3vw;
	height: 3vw;
	padding: 1vw;
}

block-library {
	padding: 5px;
	padding-top: 0;
}

block.library {
	width: 4vw;
	height: 4vw;
	min-width: 32px;
	min-height: 32px;
}

hint {
	font: max(1vw, 12px) sans-serif;
	padding: 0.5vw;
	background-color: white;
	color: #222;
}

/* simulator */

sim-controller {
	background: #eee;
	margin: 5px;
	padding: 1vw;
}

button.event {
	width: 2vw;
	height: 2vw;
	margin: 0.2vw;
}

sim-playground-area {
	background: #eee;
	margin: 5px;
	padding: 5px;
}

sim-playground {
	border: 2px silver;
}
</script>

<script type="application/json" id="aseba.json">
{
	"blocks": [
		{
			"name": "!stop",
			"aseba": {
				"statement": [
					"motor.left.target = 0\n",
					"motor.right.target = 0\n",
					"call sound.system(-1)\n",
					"call leds.circle(32,32,32,32,32,32,32,32)\n",
					"timer.period[0] = 100\n",
					"onevent timer0\n",
					"call leds.circle(0,0,0,0,0,0,0,0)\n"
				]
			}
		},
		{
			"name": "button",
			"aseba": {
				"sectionBegin": "onevent buttons\n",
				"clause": "`['center', 'forward', 'backward', 'right', 'left'].map(function (s, i) { return $[i] ? 'button.' + s : ''; }).filter(function (s) { return s; }).join(' and ') || ['center', 'forward', 'backward', 'right', 'left'].map(function (s) { return 'button.' + s; }).join(' or ')`"
			}
		},
		{
			"name": "button 1",
			"aseba": {
				"sectionBegin": "onevent buttons\n",
				"clause": "button.`['center', 'forward', 'backward', 'right', 'left'][$[0]]` != 0"
			}
		},
		{
			"name": "horiz prox",
			"aseba": {
				"sectionBegin": "onevent prox\n",
				"clause": "`[2, 1, 3, 0, 4, 5, 6].map(function (ix, i) { return $[i] ? 'prox.horizontal[' + ix + '] ' + ($[i] > 0 ? '>= 2000' : '<= 1000') : ''; }).filter(function (s) { return s; }).join(' and ') || [2, 1, 3, 0, 4, 5, 6].map(function (ix) { return 'prox.horizontal[' + ix + '] >= 2000'; }).join(' or ')`"
			}
		},
		{
			"name": "horiz prox adv",
			"aseba": {
				"sectionBegin": "onevent prox\n",
				"clause": "`[2, 1, 3, 0, 4, 5, 6].map(function (ix, i) { return $[i] ? 'prox.horizontal[' + ix + '] ' + ($[i] > 0 ? '>= ' + Math.round(7 + 33 * $[7]) : '<= ' + Math.round(7 + 33 * $[8])) + '00' : ''; }).filter(function (s) { return s; }).join(' and ') || [2, 1, 3, 0, 4, 5, 6].map(function (ix) { return 'prox.horizontal[' + ix + '] >= 2000'; }).join(' or ')`"
			}
		},
		{
			"name": "horiz prox 1",
			"aseba": {
				"sectionBegin": "onevent prox\n",
				"clause": "`[2, 1, 3, 0, 4, 5, 6].map(function (ix, i) { return $[i] ? 'prox.horizontal[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + Math.round(7 + 33 * $[7]) + '00' : ''; }).filter(function (s) { return s; }).join(' and ') || [2, 1, 3, 0, 4, 5, 6].map(function (ix) { return 'prox.horizontal[' + ix + '] >= 2000'; }).join(' or ')`"
			}
		},
		{
			"name": "ground",
			"aseba": {
				"sectionBegin": "onevent prox\n",
				"clause": "`[0, 1].map(function (ix, i) { return $[i] ? 'prox.ground.delta[' + ix + '] ' + ($[i] > 0 ? '>= 450' : '<= 400') : ''; }).filter(function (s) { return s; }).join(' and ') || [0, 1].map(function (ix) { return 'prox.ground.delta[' + ix + '] >= 450'; }).join(' or ')`"
			}

		},
		{
			"name": "ground adv",
			"aseba": {
				"sectionBegin": "onevent prox\n",
				"clause": "`[0, 1].map(function (ix, i) { return $[i] ? 'prox.ground.delta[' + ix + '] ' + ($[i] > 0 ? '>= ' + Math.round(25 + 40 * $[2]) : '<= ' + Math.round(25 + 40 * $[3])) : ''; }).filter(function (s) { return s; }).join(' and ') || [0, 1].map(function (ix) { return 'prox.ground.delta[' + ix + '] >= 450'; }).join(' or ')`"
			}
		},
		{
			"name": "ground 1",
			"aseba": {
				"sectionBegin": "onevent prox\n",
				"clause": "`[0, 1].map(function (ix, i) { return $[i] ? 'prox.ground.delta[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + Math.round(25 + 40 * $[2]) : ''; }).filter(function (s) { return s; }).join(' and ') || [0, 1].map(function (ix) { return 'prox.ground.delta[' + ix + '] >= 450'; }).join(' or ')`"
			}
		},
		{
			"name": "tap",
			"aseba": {
				"initVarDecl": [
					"var tapped\n"
				],
				"initCodeExec": [
					"tapped = 0\n"
				],
				"sectionBegin": "onevent tap\n",
				"sectionPreamble": "tapped = 1\n",
				"clause": "tapped != 0"
			}
		},
		{
			"name": "accelerometer",
			"aseba": {
				"initVarDecl": [
					"`$[0] == 0 ? 'var tapped\\n' : 'var ' + ($[0] == 1 ? 'rollAngle' : 'pitchAngle') + 'Angle\\n'`"
				],
				"initCodeExec": [
					"`$[0] == 0 ? 'tapped = 0\\n' : ''`"
				],
				"sectionBegin": "onevent `$[0] == 0 ? 'tap' : 'acc'`\n",
				"sectionPreamble": "`$[0] == 0 ? 'tapped = 1\\n' : ''`",
				"clauseInit": "`$[0] == 1 ? 'call math.atan2(rollAngle, acc[0], acc[2])\\n' : $[0] == 2 ? 'call math.atan2(pitchAngle, acc[1], acc[2])\\n' : ''`",
				"clause": "`$[0] == 0 ? 'tapped != 0' : (function (name, a) { return a <= -6 ? name + ' < ' + Math.round(2730.67 * a + 1365.33) : a >= 6 ? name + ' >= ' + Math.round(2730.67 * a - 1365.33) : name + ' >= ' + Math.round(2730.67 * a - 1365.33) + ' and ' + name + ' < ' + Math.round(2730.67 * a + 1365.33); })($[0] === 1 ? 'rollAngle' : 'pitchAngle', $[0] === 2 ? $[1] : -$[1])`"
			}
		},
		{
			"name": "roll",
			"aseba": {
				"sectionBegin": "onevent acc\n",
				"initVarDecl": "var rollAngle\n",
				"clauseInit":
					"call math.atan2(rollAngle, acc[0], acc[2])\n",
				"clause":
					"`$[0] === -12 ? 'rollAngle >= ' + Math.round(2730.67 * 12 - 1365.33) + ' or rollAngle < ' + Math.round(2730.67 * $[0] + 1365.33) : 'rollAngle >= ' + Math.round(2730.67 * $[0] - 1365.33) + ' and rollAngle < ' + Math.round(2730.67 * $[0] + 1365.33)`"
			}
		},
		{
			"name": "pitch",
			"aseba": {
				"sectionBegin": "onevent acc\n",
				"initVarDecl": "var pitchAngle\n",
				"clauseInit":
					"call math.atan2(pitchAngle, acc[1], acc[2])\n",
				"clause":
					"`$[0] === -12 ? 'pitchAngle >= ' + Math.round(2730.67 * 12 - 1365.33) + ' or pitchAngle < ' + Math.round(2730.67 * $[0] + 1365.33) : 'pitchAngle >= ' + Math.round(2730.67 * $[0] - 1365.33) + ' and pitchAngle < ' + Math.round(2730.67 * $[0] + 1365.33)`"
			}
		},
		{
			"name": "yaw",
			"aseba": {
				"sectionBegin": "onevent acc\n",
				"initVarDecl": "var yawAngle\n",
				"clauseInit":
					"call math.atan2(yawAngle, acc[0], acc[1])\n",
				"clause":
					"`$[0] === -12 ? 'yawAngle >= ' + Math.round(2730.67 * 12 - 1365.33) + ' or yawAngle < ' + Math.round(2730.67 * $[0] + 1365.33) : 'yawAngle >= ' + Math.round(2730.67 * $[0] - 1365.33) + ' and yawAngle < ' + Math.round(2730.67 * $[0] + 1365.33)`"
			}
		},
		{
			"name": "clap",
			"aseba": {
				"initCodeExec": [
					[
						"# setup threshold for detecting claps\n",
						"mic.threshold = 250\n"
					]
				],
				"sectionBegin": "onevent mic\n",
				"clause": "mic.intensity > mic.threshold",
				"clauseOptional": true
			}
		},
		{
			"name": "init",
			"aseba": {
				"sectionBegin": "# initialization\n"
			}
		},
		{
			"name": "timer",
			"aseba": {
				"initVarDecl": [
					"var timerElapsed\n"
				],
				"initCodeExec": [
					[
						"# stop timer 0\n",
						"timer.period[0] = 0\n"
					],
					"timerElapsed = 0\n"
				],
				"sectionBegin": "onevent timer0\n",
				"sectionPreamble": "timerElapsed = 1\ntimer.period[0] = 0\n"
			}
		},
		{
			"name": "state",
			"aseba": {
				"initVarDecl": [
					"var state[4]\n"
				],
				"initCodeExec": [
					"state = [0, 0, 0, 0]\n"
				],
				"clause": "`$.map(function (v, i) { return 'state[' + i + ']' + (v >= 0 ? ' == 1' : ' == 0'); }).filter(function (v, i) { return $[i]; }).join(' and ')`"
			}
		},
		{
			"name": "state 8",
			"aseba": {
				"initVarDecl": [
					"var state8\n"
				],
				"initCodeExec": [
					"state8 = 0\n"
				],
				"clause": "state8 == `$[0]`"
			}
		},
		{
			"name": "counter comparison",
			"aseba": {
				"initVarDecl": [
					"var counter\n"
				],
				"initCodeExec": [
					"counter = 0\n"
				],
				"clause": "counter `$[0] === 0 ? '==' : $[0] > 0 ? '>=' : '<='` `$[1]`"
			}
		},
		{
			"name": "color state",
			"aseba": {
				"initVarDecl": [
					"var topColor[3]\n"
				],
				"initCodeExec": [
					"topColor = [0, 0, 0]\n"
				],
				"clause": "`$.map(function (p, i) { return 'topColor[' + i + '] / 11 == ' + Math.floor(p * 2.99); }).join(' and ')`"
			}
		},
		{
			"name": "color 8 state",
			"aseba": {
				"initVarDecl": [
					"var topColor[3]\n"
				],
				"initCodeExec": [
					"topColor = [0, 0, 0]\n"
				],
				"clause": "topColor[0] `$[0] % 2 ? '>=' : '<'` 16 && topColor[1] `$[0] % 4 >= 2 ? '>=' : '<'` 16 && topColor[2] `$[0] >= 4 ? '>=' : '<'` 16"
			}
		},
		{
			"name": "motor state",
			"aseba": {
				"clause": [
					"`$[0] == 0 ? 'abs(' : ''`motor.left.target`$[0] > 0 ? ' > ' : $[0] < 0 ? ' < -' : ') < '`250 ",
					"and `$[1] == 0 ? 'abs(' : ''`motor.right.target`$[1] > 0 ? ' > ' : $[1] < 0 ? ' < -' : ') < '`250"
				]
			}
		},
		{
			"name": "motor",
			"aseba": {
				"initCodeExec": [
					[
						"# reset outputs\n",
						"call leds.top(0, 0, 0)\n",
						"call leds.bottom.left(0, 0, 0)\n",
						"call leds.bottom.right(0, 0, 0)\n",
						"call leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"
					]
				],
				"statement": [
					"motor.left.target = `Math.round(500 * $[0])`\n",
					"motor.right.target = `Math.round(500 * $[1])`\n"
				]
			}
		},
		{
			"name": "move",
			"aseba": {
				"initCodeExec": [
					[
						"# reset outputs\n",
						"call leds.top(0, 0, 0)\n",
						"call leds.bottom.left(0, 0, 0)\n",
						"call leds.bottom.right(0, 0, 0)\n",
						"call leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"
					]
				],
				"statement": [
					"motor.left.target = `[0, 100, -100, 75, 125, -100, 100][$[0]]`\n",
					"motor.right.target = `[0, 100, -100, 125, 75, 100, -100][$[0]]`\n"
				]
			}
		},
		{
			"name": "nn obstacles",
			"aseba": {
				"initCodeExec": [
					[
						"# reset outputs\n",
						"call leds.top(0, 0, 0)\n",
						"call leds.bottom.left(0, 0, 0)\n",
						"call leds.bottom.right(0, 0, 0)\n",
						"call leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"
					]
				],
				"statement": [
					"motor.left.target = `Math.round(500 * $[0])`",
					"`Math.round(20 * $[1]) ? ' - prox.horizontal[2] / 10 * ' + Math.round(20 * $[1]).toString(10) + ' / 16' : ''`",
					"`Math.round(20 * $[2]) ? ' + prox.horizontal[0] / 10 * ' + Math.round(20 * $[2]).toString(10) + ' / 16' : ''`",
					"`Math.round(20 * $[3]) ? ' - prox.horizontal[4] / 10 * ' + Math.round(20 * $[3]).toString(10) + ' / 16' : ''`\n",
					"motor.right.target = `Math.round(500 * $[0])`",
					"`Math.round(20 * $[1]) ? ' - prox.horizontal[2] / 10 * ' + Math.round(20 * $[1]).toString(10) + ' / 16' : ''`",
					"`Math.round(20 * $[2]) ? ' + prox.horizontal[4] / 10 * ' + Math.round(20 * $[2]).toString(10) + ' / 16' : ''`",
					"`Math.round(20 * $[3]) ? ' - prox.horizontal[0] / 10 * ' + Math.round(20 * $[3]).toString(10) + ' / 16' : ''`\n"
				]
			}
		},
		{
			"name": "top color",
			"aseba": {
				"initVarDecl": [
					"var topColor[3]\n"
				],
				"initCodeExec": [
					"topColor = [0, 0, 0]\n",
					[
						"# reset outputs\n",
						"call leds.top(0, 0, 0)\n",
						"call leds.bottom.left(0, 0, 0)\n",
						"call leds.bottom.right(0, 0, 0)\n",
						"call leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"
					]
				],
				"statement": [
					"call leds.top(`$.map(function (x) { return Math.round(32 * x); }).join(', ')`)\n",
					"topColor = [`$.map(function (x) { return Math.round(32 * x); }).join(', ')`]\n"
				],
				"statementWithoutInit":
					"call leds.top(`$.map(function (x) { return Math.round(32 * x); }).join(', ')`)\n"
			}
		},
		{
			"name": "top color 8",
			"aseba": {
				"initVarDecl": [
					"var topColor[3]\n"
				],
				"initCodeExec": [
					"topColor = [0, 0, 0]\n",
					[
						"# reset outputs\n",
						"call leds.top(0, 0, 0)\n",
						"call leds.bottom.left(0, 0, 0)\n",
						"call leds.bottom.right(0, 0, 0)\n",
						"call leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"
					]
				],
				"statement": [
					"call leds.top(`['0,0,0','32,0,0','0,32,0','32,32,0','0,0,32','32,0,32','0,32,32','32,32,32'][$[0]]`)\n",
					"topColor = [`['0,0,0','32,0,0','0,32,0','32,32,0','0,0,32','32,0,32','0,32,32','32,32,32'][$[0]]`]\n"
				]
			}
		},
		{
			"name": "bottom color",
			"aseba": {
				"initCodeExec": [
					[
						"# reset outputs\n",
						"call leds.top(0, 0, 0)\n",
						"call leds.bottom.left(0, 0, 0)\n",
						"call leds.bottom.right(0, 0, 0)\n",
						"call leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"
					]
				],
				"statement": [
					"call leds.bottom.left(`$.map(function (x) { return Math.round(32 * x); }).join(', ')`)\n",
					"call leds.bottom.right(`$.map(function (x) { return Math.round(32 * x); }).join(', ')`)\n"
				]
			}
		},
		{
			"name": "bottom-left color",
			"aseba": {
				"initCodeExec": [
					[
						"# reset outputs\n",
						"call leds.top(0, 0, 0)\n",
						"call leds.bottom.left(0, 0, 0)\n",
						"call leds.bottom.right(0, 0, 0)\n",
						"call leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"
					]
				],
				"statement": [
					"call leds.bottom.left(`$.map(function (x) { return Math.round(32 * x); }).join(', ')`)\n"
				]
			}
		},
		{
			"name": "bottom-right color",
			"aseba": {
				"initCodeExec": [
					[
						"# reset outputs\n",
						"call leds.top(0, 0, 0)\n",
						"call leds.bottom.left(0, 0, 0)\n",
						"call leds.bottom.right(0, 0, 0)\n",
						"call leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"
					]
				],
				"statement": [
					"call leds.bottom.right(`$.map(function (x) { return Math.round(32 * x); }).join(', ')`)\n"
				]
			}
		},
		{
			"name": "bottom color 8",
			"aseba": {
				"initCodeExec": [
					[
						"# reset outputs\n",
						"call leds.top(0, 0, 0)\n",
						"call leds.bottom.left(0, 0, 0)\n",
						"call leds.bottom.right(0, 0, 0)\n",
						"call leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"
					]
				],
				"statement": [
					"call leds.bottom.left(`['0,0,0','32,0,0','0,32,0','32,32,0','0,0,32','32,0,32','0,32,32','32,32,32'][$[0]]`)\n",
					"call leds.bottom.right(`['0,0,0','32,0,0','0,32,0','32,32,0','0,0,32','32,0,32','0,32,32','32,32,32'][$[0]]`)\n"
				]
			}
		},
		{
			"name": "bottom-left color 8",
			"aseba": {
				"initCodeExec": [
					[
						"# reset outputs\n",
						"call leds.top(0, 0, 0)\n",
						"call leds.bottom.left(0, 0, 0)\n",
						"call leds.bottom.right(0, 0, 0)\n",
						"call leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"
					]
				],
				"statement": [
					"call leds.bottom.left(`['0,0,0','32,0,0','0,32,0','32,32,0','0,0,32','32,0,32','0,32,32','32,32,32'][$[0]]`)\n"
				]
			}
		},
		{
			"name": "bottom-right color 8",
			"aseba": {
				"initCodeExec": [
					[
						"# reset outputs\n",
						"call leds.top(0, 0, 0)\n",
						"call leds.bottom.left(0, 0, 0)\n",
						"call leds.bottom.right(0, 0, 0)\n",
						"call leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"
					]
				],
				"statement": [
					"call leds.bottom.right(`['0,0,0','32,0,0','0,32,0','32,32,0','0,0,32','32,0,32','0,32,32','32,32,32'][$[0]]`)\n"
				]
			}
		},
		{
			"name": "notes",
			"aseba": {
				"initVarDecl": [
					[
						"# variables for notes\n",
						"var notes[6]\n",
						"var durations[6]\n",
						"var note_index\n",
						"var note_count\n",
						"var wave[142]\n",
						"var i\n",
						"var wave_phase\n",
						"var wave_intensity\n"
					]
				],
				"initCodeExec": [
					[
						"# init. variables for notes\n",
						"note_index = 6\n",
						"note_count = 6\n"
					],
					[
						"# compute a sinus wave for sound\n",
						"for i in 0 : 141 do\n",
						"wave_phase = (i - 70) * 468\n",
						"call math.cos(wave_intensity, wave_phase)\n",
						"wave[i] = wave_intensity / 256\n",
						"end\ncall sound.wave(wave)\n"
					],
					[
						"call sound.system(-1)\n"
					]
				],
				"initCodeDecl": [
					[
						"# when a note is finished, play the next one\n",
						"onevent sound.finished\n",
						"if note_index != note_count then\n",
						"call sound.freq(notes[note_index], durations[note_index])\n",
						"note_index++\n",
						"end\n"
					]
				],
				"statement": [
					"notes = [`$.filter(function (a, i) { return i % 2 == 0; }).map(function (h, i) { return $[2 * i + 1] ? [370, 415, 466, 494, 554][h] : 0; }).join(', ')`]\n",
					"durations = [`$.filter(function (a, i) { return i % 2 == 1; }).map(function (d) { return d ? 10 * d : 28; }).join(', ')`]\n",
					"note_index = 1\n",
					"note_count = 6\n",
					"call sound.freq(notes[0], durations[0])\n"
				]
			}
		},
		{
			"name": "play",
			"aseba": {
				"initCodeExec": [
					"call sound.system(-1)\n"
				],
				"statement": "call sound.play(`$[0].toString(10)`)\n"
			}
		},
		{
			"name": "play stop",
			"aseba": {
				"initCodeExec": [
					"call sound.system(-1)\n"
				],
				"statement": "call sound.play(-1)\n"
			}
		},
		{
			"name": "set state",
			"aseba": {
				"initVarDecl": [
					"var state[4]\n"
				],
				"initCodeExec": [
					"state = [0, 0, 0, 0]\n"
				],
				"initCodeDecl": [
					[
						"sub display_state\n",
						"call leds.circle(0,state[1]*32,0,state[3]*32,0,state[2]*32,0,state[0]*32)\n"
					]
				],
				"statement": [
					"`$.map(function (v, i) { return v ? 'state[' + i + '] = ' + (v > 0 ? '1' : '0') + '\\n' : ''; }).join('')`",
					"`$[0] || $[1] || $[2] || $[3] ? 'callsub display_state\\n' : ''`"
				]
			}
		},
		{
			"name": "toggle state",
			"aseba": {
				"initVarDecl": [
					"var state[4]\n"
				],
				"initCodeExec": [
					"state = [0, 0, 0, 0]\n"
				],
				"initCodeDecl": [
					[
						"sub display_state\n",
						"call leds.circle(0,state[1]*32,0,state[3]*32,0,state[2]*32,0,state[0]*32)\n"
					]
				],
				"statement": [
					"`$.map(function (v, i) { return v ? 'state[' + i + '] = 1 - state[' + i + ']\\n' : ''; }).join('')`",
					"`$[0] || $[1] || $[2] || $[3] ? 'callsub display_state\\n' : ''`"
				]
			}
		},
		{
			"name": "set state 8",
			"aseba": {
				"initVarDecl": [
					"var state8\n"
				],
				"initCodeExec": [
					"state8 = 0\n"
				],
				"initCodeDecl": [
					[
						"sub display_state8\n",
						"call leds.circle((state8==0)*32, (state8==1)*32, (state8==2)*32, (state8==3)*32, (state8==4)*32, (state8==5)*32, (state8==6)*32, (state8==7)*32)\n"
					]
				],
				"statement": [
					"state8 = `$[0]`\n",
					"callsub display_state8\n"
				],
				"statementWithoutInit": [
					"call leds.circle(`$[0] === 0 ? 32 : 0`, `$[0] === 1 ? 32 : 0`, `$[0] === 2 ? 32 : 0`, `$[0] === 3 ? 32 : 0`, ",
						"`$[0] === 4 ? 32 : 0`, `$[0] === 5 ? 32 : 0`, `$[0] === 6 ? 32 : 0`, `$[0] === 7 ? 32 : 0`)\n"
				]
			}
		},
		{
			"name": "change state 8",
			"aseba": {
				"initVarDecl": [
					"var state8\n"
				],
				"initCodeExec": [
					"state8 = 0\n"
				],
				"initCodeDecl": [
					[
						"sub display_state8\n",
						"call leds.circle((state8==0)*32, (state8==1)*32, (state8==2)*32, (state8==3)*32, (state8==4)*32, (state8==5)*32, (state8==6)*32, (state8==7)*32)\n"
					]
				],
				"statement": [
					"state8 = (state8 + `$[0] > 0 ? 1 : 7`) % 8\n",
					"callsub display_state8\n"
				],
				"statementWithoutInit": [
					"call leds.circle(`$[0] === 0 ? 32 : 0`, `$[0] === 1 ? 32 : 0`, `$[0] === 2 ? 32 : 0`, `$[0] === 3 ? 32 : 0`, ",
						"`$[0] === 4 ? 32 : 0`, `$[0] === 5 ? 32 : 0`, `$[0] === 6 ? 32 : 0`, `$[0] === 7 ? 32 : 0`)\n"
				]
			}
		},
		{
			"name": "set counter",
			"aseba": {
				"initVarDecl": [
					"var counter\n"
				],
				"initCodeExec": [
					"counter = 0\n"
				],
				"initCodeDecl": [
					[
						"sub display_counter\n",
						"call leds.circle((counter&1)<<5,(counter&2)<<4,(counter&4)<<3,(counter&8)<<2,(counter&16)<<1,counter&32,(counter&64)>>1,(counter&128)>>2)\n"
					]
				],
				"statement": [
					"`$[0] === 0 ? 'counter = 0' : $[0] > 0 ? 'if counter < 255 then\\ncounter++\\nend' : 'if counter > 0 then\\ncounter--\\nend'`\n",
					"callsub display_counter\n"
				]
			}
		},
		{
			"name": "set timer",
			"aseba": {
				"initVarDecl": [
					"var timerElapsed\n"
				],
				"initCodeExec": [
					[
						"# stop timer 0\n",
						"timer.period[0] = 0\n"
					],
					"timerElapsed = 0\n"
				],
				"statement": [
					"timer.period[0] = `Math.round(1000 * $[0])`\n",
					"timerElapsed = 0\n"
				]
			}
		},
		{
			"name": "set timer log",
			"aseba": {
				"initVarDecl": [
					"var timerElapsed\n"
				],
				"initCodeExec": [
					[
						"# stop timer 0\n",
						"timer.period[0] = 0\n"
					],
					"timerElapsed = 0\n"
				],
				"statement": [
					"timer.period[0] = `Math.round(1000 * $[0])`\n",
					"timerElapsed = 0\n"
				]
			}
		},
		{
			"name": "picture comment",
			"aseba": {}
		}
	]
}
</script>

<script type="application/json" id="l2.json">
{
	"blocks": [
		{
			"name": "!stop",
			"l2": {
				"statement": [
					"motor.left.target = 0;\n",
					"motor.right.target = 0;\n",
					"sound.system(-1);\n",
					"leds.circle(32,32,32,32,32,32,32,32);\n",
					"timer.period[0] = 100;\n",
					"onevent timer0 {\n",
					"leds.circle(0,0,0,0,0,0,0,0);\n",
					"}\n"
				]
			}
		},
		{
			"name": "button",
			"l2": {
				"sectionBegin": "onevent buttons {\n",
				"sectionEnd": "}\n",
				"clause": "`['center', 'forward', 'backward', 'right', 'left'].map(function (s, i) { return $[i] ? 'button.' + s : ''; }).filter(function (s) { return s; }).join(' && ') || ['center', 'forward', 'backward', 'right', 'left'].map(function (s) { return 'button.' + s; }).join(' || ')`"
			}
		},
		{
			"name": "button 1",
			"l2": {
				"sectionBegin": "onevent buttons {\n",
				"sectionEnd": "}\n",
				"clause": "button.`['center', 'forward', 'backward', 'right', 'left'][$[0]]`"
			}
		},
		{
			"name": "horiz prox",
			"l2": {
				"sectionBegin": "onevent prox {\n",
				"sectionEnd": "}\n",
				"clause": "`[2, 1, 3, 0, 4, 5, 6].map(function (ix, i) { return $[i] ? 'prox.horizontal[' + ix + '] ' + ($[i] > 0 ? '>= 2000' : '<= 1000') : ''; }).filter(function (s) { return s; }).join(' && ') || [2, 1, 3, 0, 4, 5, 6].map(function (ix) { return 'prox.horizontal[' + ix + '] >= 2000'; }).join(' || ')`"
			}
		},
		{
			"name": "horiz prox adv",
			"l2": {
				"sectionBegin": "onevent prox {\n",
				"sectionEnd": "}\n",
				"clause": "`[2, 1, 3, 0, 4, 5, 6].map(function (ix, i) { return $[i] ? 'prox.horizontal[' + ix + '] ' + ($[i] > 0 ? '>= ' + Math.round(7 + 33 * $[7]) : '<= ' + Math.round(7 + 33 * $[8])) + '00' : ''; }).filter(function (s) { return s; }).join(' && ') || [2, 1, 3, 0, 4, 5, 6].map(function (ix) { return 'prox.horizontal[' + ix + '] >= 2000'; }).join(' || ')`"
			}
		},
		{
			"name": "horiz prox 1",
			"l2": {
				"sectionBegin": "onevent prox {\n",
				"sectionEnd": "}\n",
				"clause": "`[2, 1, 3, 0, 4, 5, 6].map(function (ix, i) { return $[i] ? 'prox.horizontal[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + Math.round(7 + 33 * $[7]) + '00' : ''; }).filter(function (s) { return s; }).join(' && ') || [2, 1, 3, 0, 4, 5, 6].map(function (ix) { return 'prox.horizontal[' + ix + '] >= 2000'; }).join(' || ')`"
			}
		},
		{
			"name": "ground",
			"l2": {
				"sectionBegin": "onevent prox {\n",
				"sectionEnd": "}\n",
				"clause": "`[0, 1].map(function (ix, i) { return $[i] ? 'prox.ground.delta[' + ix + '] ' + ($[i] > 0 ? '>= 450' : '<= 400') : ''; }).filter(function (s) { return s; }).join(' && ') || [0, 1].map(function (ix) { return 'prox.ground.delta[' + ix + '] >= 450'; }).join(' || ')`"
			}

		},
		{
			"name": "ground adv",
			"l2": {
				"sectionBegin": "onevent prox {\n",
				"sectionEnd": "}\n",
				"clause": "`[0, 1].map(function (ix, i) { return $[i] ? 'prox.ground.delta[' + ix + '] ' + ($[i] > 0 ? '>= ' + Math.round(25 + 40 * $[2]) : '<= ' + Math.round(25 + 40 * $[3])) : ''; }).filter(function (s) { return s; }).join(' && ') || [0, 1].map(function (ix) { return 'prox.ground.delta[' + ix + '] >= 450'; }).join(' || ')`"
			}
		},
		{
			"name": "ground 1",
			"l2": {
				"sectionBegin": "onevent prox {\n",
				"sectionEnd": "}\n",
				"clause": "`[0, 1].map(function (ix, i) { return $[i] ? 'prox.ground.delta[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + Math.round(25 + 40 * $[2]) : ''; }).filter(function (s) { return s; }).join(' && ') || [0, 1].map(function (ix) { return 'prox.ground.delta[' + ix + '] >= 450'; }).join(' || ')`"
			}
		},
		{
			"name": "tap",
			"l2": {
				"initVarDecl": [
					"bool tapped;\n"
				],
				"initCodeExec": [
					"tapped = false;\n"
				],
				"sectionBegin": "onevent tap {\n",
				"sectionEnd": "}\n",
				"sectionPreamble": "tapped = true;\n",
				"clause": "tapped"
			}
		},
		{
			"name": "accelerometer",
			"l2": {
				"initVarDecl": [
					"`$[0] == 0 ? 'bool tapped;\\n' : ''`"
				],
				"initCodeExec": [
					"`$[0] == 0 ? 'tapped = false;\\n' : ''`"
				],
				"sectionBegin": "onevent `$[0] == 0 ? 'tap' : 'acc'` {\n",
				"sectionEnd": "}\n",
				"sectionPreamble": "`$[0] == 0 ? 'tapped = true;\\n' : ''`",
				"clauseInit": "`$[0] == 1 ? 'fixed rollAngle = atan2(acc[0], acc[2]);\\n' : $[0] == 2 ? 'fixed pitchAngle = atan2(acc[1], acc[2]);\\n' : ''`",
				"clause": "`$[0] == 0 ? 'tapped' : (function (name, a) { return a <= -6 ? name + ' < ' + (Math.PI / 12 * (a + 0.5)).toFixed(2) : a >= 6 ? name + ' >= ' + (Math.PI / 12 * (a - 0.5)).toFixed(2) : name + ' >= ' + (Math.PI / 12 * (a - 0.5)).toFixed(2) + ' && ' + name + ' < ' + (Math.PI / 12 * (a + 0.5)).toFixed(2); })($[0] === 1 ? 'rollAngle' : 'pitchAngle', $[0] === 2 ? $[1] : -$[1])`"
			}
		},
		{
			"name": "roll",
			"l2": {
				"sectionBegin": "onevent acc {\n",
				"sectionEnd": "}\n",
				"clauseInit":
					"fixed rollAngle = atan2(acc[0], acc[2]);\n",
				"clause":
					"rollAngle >= `(Math.PI / 12 * ($[0] - 0.5)).toFixed(2)` && rollAngle < `(Math.PI / 12 * ($[0] + 0.5)).toFixed(2)`"
			}
		},
		{
			"name": "pitch",
			"l2": {
				"sectionBegin": "onevent acc {\n",
				"sectionEnd": "}\n",
				"clauseInit":
					"fixed pitchAngle = atan2(acc[1], acc[2]);\n",
				"clause":
					"pitchAngle >= `(Math.PI / 12 * (-$[0] - 0.5)).toFixed(2)` && pitchAngle < `(Math.PI / 12 * (-$[0] + 0.5)).toFixed(2)`"
			}
		},
		{
			"name": "yaw",
			"l2": {
				"sectionBegin": "onevent acc {\n",
				"sectionEnd": "}\n",
				"clauseInit":
					"fixed yawAngle = atan2(acc[0], acc[1]);\n",
				"clause":
					"yawAngle >= `(Math.PI / 12 * ($[0] - 0.5)).toFixed(2)` && yawAngle < `(Math.PI / 12 * ($[0] + 0.5)).toFixed(2)`"
			}
		},
		{
			"name": "clap",
			"l2": {
				"initCodeExec": [
					[
						"// setup threshold for detecting claps\n",
						"mic.threshold = 250;\n"
					]
				],
				"sectionBegin": "onevent mic {\n",
				"sectionEnd": "}\n",
				"clause": "mic.intensity > mic.threshold",
				"clauseOptional": true
			}
		},
		{
			"name": "init",
			"l2": {
				"sectionBegin": "// initialization\n"
			}
		},
		{
			"name": "timer",
			"l2": {
				"initVarDecl": [
					"bool timerElapsed;\n"
				],
				"initCodeExec": [
					[
						"// stop timer 0\n",
						"timer.period[0] = 0;\n"
					],
					"timerElapsed = false;\n"
				],
				"sectionBegin": "onevent timer0 {\n",
				"sectionEnd": "}\n",
				"sectionPreamble": "timerElapsed = true;\ntimer.period[0] = 0;\n"
			}
		},
		{
			"name": "state",
			"l2": {
				"initVarDecl": [
					[
						"// variables for state\n",
						"bool state[4];\n"
					]
				],
				"initCodeExec": [
					"state = [false, false, false, false];\n"
				],
				"clause": "`$.map(function (v, i) { return (v >= 0 ? '' : '!') + 'state[' + i + ']'; }).filter(function (v, i) { return $[i]; }).join(' && ')`"
			}
		},
		{
			"name": "state 8",
			"l2": {
				"initVarDecl": [
					[
						"// variables for exclusive state\n",
						"int state8;\n"
					]
				],
				"initCodeExec": [
					"state8 = 0;\n"
				],
				"clause": "state8 == `$[0]`"
			}
		},
		{
			"name": "counter comparison",
			"l2": {
				"initVarDecl": [
					"int counter;\n"
				],
				"initCodeExec": [
					"counter = 0;\n"
				],
				"clause": "counter `$[0] === 0 ? '==' : $[0] > 0 ? '>=' : '<='` `$[1]`"
			}
		},
		{
			"name": "color state",
			"l2": {
				"initVarDecl": [
					"int topColor[3];\n"
				],
				"initCodeExec": [
					"topColor = [0, 0, 0];\n"
				],
				"clause": "`$.map(function (p, i) { return 'topColor[' + i + '] / 11 == ' + Math.floor(p * 2.99); }).join(' && ')`"
			}
		},
		{
			"name": "color 8 state",
			"l2": {
				"initVarDecl": [
					"int topColor[3];\n"
				],
				"initCodeExec": [
					"topColor = [0, 0, 0];\n"
				],
				"clause": "topColor[0] `$[0] % 2 ? '>=' : '<'` 16 && topColor[1] `$[0] % 4 >= 2 ? '>=' : '<'` 16 && topColor[2] `$[0] >= 4 ? '>=' : '<'` 16"
			}
		},
		{
			"name": "motor state",
			"l2": {
				"clause": [
					"`$[0] == 0 ? 'abs(' : ''`motor.left.target`$[0] > 0 ? ' > ' : $[0] < 0 ? ' < -' : ') < '`250 ",
					"&& `$[1] == 0 ? 'abs(' : ''`motor.right.target`$[1] > 0 ? ' > ' : $[1] < 0 ? ' < -' : ') < '`250"
				]
			}
		},
		{
			"name": "motor",
			"l2": {
				"initCodeExec": [
					[
						"// reset outputs\n",
						"leds.top(0, 0, 0);\n",
						"leds.bottom.left(0, 0, 0);\n",
						"leds.bottom.right(0, 0, 0);\n",
						"leds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"
					]
				],
				"statement":
					[
						"motor.left.target = `Math.round(500 * $[0])`;\n",
						"motor.right.target = `Math.round(500 * $[1])`;\n"
					]
			}
		},
		{
			"name": "move",
			"l2": {
				"initCodeExec": [
					[
						"// reset outputs\n",
						"leds.top(0, 0, 0);\n",
						"leds.bottom.left(0, 0, 0);\n",
						"leds.bottom.right(0, 0, 0);\n",
						"leds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"
					]
				],
				"statement": [
					"motor.left.target = `[0, 100, -100, 75, 125, -100, 100][$[0]]`;\n",
					"motor.right.target = `[0, 100, -100, 125, 75, 100, -100][$[0]]`;\n"
				]
			}
		},
		{
			"name": "nn obstacles",
			"l2": {
				"initCodeExec": [
					[
						"// reset outputs\n",
						"leds.top(0, 0, 0);\n",
						"leds.bottom.left(0, 0, 0);\n",
						"leds.bottom.right(0, 0, 0);\n",
						"leds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"
					]
				],
				"statement": [
					"motor.left.target = `Math.round(500 * $[0])`",
					"`Math.round(20 * $[1]) ? ' - prox.horizontal[2] / 10 * ' + Math.round(20 * $[1]).toString(10) + ' / 16' : ''`",
					"`Math.round(20 * $[2]) ? ' + prox.horizontal[0] / 10 * ' + Math.round(20 * $[2]).toString(10) + ' / 16' : ''`",
					"`Math.round(20 * $[3]) ? ' - prox.horizontal[4] / 10 * ' + Math.round(20 * $[3]).toString(10) + ' / 16' : ''`;\n",
					"motor.right.target = `Math.round(500 * $[0])`",
					"`Math.round(20 * $[1]) ? ' - prox.horizontal[2] / 10 * ' + Math.round(20 * $[1]).toString(10) + ' / 16' : ''`",
					"`Math.round(20 * $[2]) ? ' + prox.horizontal[4] / 10 * ' + Math.round(20 * $[2]).toString(10) + ' / 16' : ''`",
					"`Math.round(20 * $[3]) ? ' - prox.horizontal[0] / 10 * ' + Math.round(20 * $[3]).toString(10) + ' / 16' : ''`;\n"
				]
			}
		},
		{
			"name": "top color",
			"l2": {
				"initVarDecl": [
					"int topColor[3];\n"
				],
				"initCodeExec": [
					"topColor = [0, 0, 0];\n",
					[
						"// reset outputs\n",
						"leds.top(0, 0, 0);\n",
						"leds.bottom.left(0, 0, 0);\n",
						"leds.bottom.right(0, 0, 0);\n",
						"leds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"
					]
				],
				"statement": [
					"leds.top(`$.map(function (x) { return Math.round(32 * x); }).join(', ')`);\n",
					"topColor = [`$.map(function (x) { return Math.round(32 * x); }).join(', ')`];\n"
				],
				"statementWithoutInit":
					"leds.top(`$.map(function (x) { return Math.round(32 * x); }).join(', ')`);\n"
			}
		},
		{
			"name": "top color 8",
			"l2": {
				"initVarDecl": [
					"int topColor[3];\n"
				],
				"initCodeExec": [
					"topColor = [0, 0, 0];\n",
					[
						"// reset outputs\n",
						"leds.top(0, 0, 0);\n",
						"leds.bottom.left(0, 0, 0);\n",
						"leds.bottom.right(0, 0, 0);\n",
						"leds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"
					]
				],
				"statement": [
					"leds.top(`['0,0,0','32,0,0','0,32,0','32,32,0','0,0,32','32,0,32','0,32,32','32,32,32'][$[0]]`);\n",
					"topColor = [`['0,0,0','32,0,0','0,32,0','32,32,0','0,0,32','32,0,32','0,32,32','32,32,32'][$[0]]`];\n"
				]
			}
		},
		{
			"name": "bottom color",
			"l2": {
				"initCodeExec": [
					[
						"// reset outputs\n",
						"leds.top(0, 0, 0);\n",
						"leds.bottom.left(0, 0, 0);\n",
						"leds.bottom.right(0, 0, 0);\n",
						"leds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"
					]
				],
				"statement": [
					"leds.bottom.left(`$.map(function (x) { return Math.round(32 * x); }).join(', ')`);\n",
					"leds.bottom.right(`$.map(function (x) { return Math.round(32 * x); }).join(', ')`);\n"
				]
			}
		},
		{
			"name": "bottom-left color",
			"l2": {
				"initCodeExec": [
					[
						"// reset outputs\n",
						"leds.top(0, 0, 0);\n",
						"leds.bottom.left(0, 0, 0);\n",
						"leds.bottom.right(0, 0, 0);\n",
						"leds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"
					]
				],
				"statement": [
					"leds.bottom.left(`$.map(function (x) { return Math.round(32 * x); }).join(', ')`);\n"
				]
			}
		},
		{
			"name": "bottom-right color",
			"l2": {
				"initCodeExec": [
					[
						"// reset outputs\n",
						"leds.top(0, 0, 0);\n",
						"leds.bottom.left(0, 0, 0);\n",
						"leds.bottom.right(0, 0, 0);\n",
						"leds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"
					]
				],
				"statement": [
					"leds.bottom.right(`$.map(function (x) { return Math.round(32 * x); }).join(', ')`);\n"
				]
			}
		},
		{
			"name": "bottom color 8",
			"l2": {
				"initCodeExec": [
					[
						"// reset outputs\n",
						"leds.top(0, 0, 0);\n",
						"leds.bottom.left(0, 0, 0);\n",
						"leds.bottom.right(0, 0, 0);\n",
						"leds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"
					]
				],
				"statement": [
					"leds.bottom.left(`['0,0,0','32,0,0','0,32,0','32,32,0','0,0,32','32,0,32','0,32,32','32,32,32'][$[0]]`);\n",
					"leds.bottom.right(`['0,0,0','32,0,0','0,32,0','32,32,0','0,0,32','32,0,32','0,32,32','32,32,32'][$[0]]`);\n"
				]
			}
		},
		{
			"name": "bottom-left color 8",
			"l2": {
				"initCodeExec": [
					[
						"// reset outputs\n",
						"leds.top(0, 0, 0);\n",
						"leds.bottom.left(0, 0, 0);\n",
						"leds.bottom.right(0, 0, 0);\n",
						"leds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"
					]
				],
				"statement": [
					"leds.bottom.left(`['0,0,0','32,0,0','0,32,0','32,32,0','0,0,32','32,0,32','0,32,32','32,32,32'][$[0]]`);\n"
				]
			}
		},
		{
			"name": "bottom-right color 8",
			"l2": {
				"initCodeExec": [
					[
						"// reset outputs\n",
						"leds.top(0, 0, 0);\n",
						"leds.bottom.left(0, 0, 0);\n",
						"leds.bottom.right(0, 0, 0);\n",
						"leds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"
					]
				],
				"statement": [
					"leds.bottom.right(`['0,0,0','32,0,0','0,32,0','32,32,0','0,0,32','32,0,32','0,32,32','32,32,32'][$[0]]`);\n"
				]
			}
		},
		{
			"name": "notes",
			"l2": {
				"initVarDecl": [
					"const pi = 3.14;\n",
					[
						"// variables for notes\n",
						"int notes[6];\n",
						"int durations[6];\n",
						"int note_index;\n",
						"int wave[142];\n"
					]
				],
				"initCodeExec": [
					[
						"// init notes\n",
						"for (int i = 0; i < size(wave); i++) {\n",
						"wave[i] = 128 * sin(fixed(i) / size(wave) * 2 * pi);\n",
						"}\n",
						"sound.wave(wave);\n",
						"note_index = 6;\n"
					],
					[
						"sound.system(-1);\n"
					]
				],
				"initCodeDecl": [
					[
						"// when a note is finished, play the next one\n",
						"onevent sound.finished {\n",
						"if (note_index < size(notes)) {\n",
						"sound.freq(notes[note_index], durations[note_index]);\n",
						"note_index++;\n",
						"}\n",
						"}\n"
					]
				],
				"statement": [
					"notes = [`$.filter(function (a, i) { return i % 2 == 0; }).map(function (h, i) { return $[2 * i + 1] ? [262, 311, 370, 440, 524, 370][h] : 0; }).join(', ')`];\n",
					"durations = [`$.filter(function (a, i) { return i % 2 == 1; }).map(function (d) { return d ? 7 * d : 28; }).join(', ')`];\n",
					"note_index = 1;\n",
					"note_count = 6;\n",
					"sound.freq(notes[0], durations[0]);\n"
				]
			}
		},
		{
			"name": "play",
			"l2": {
				"initCodeExec": [
					"sound.system(-1);\n"
				],
				"statement": "sound.play(`$[0].toString(10)`);\n"
			}
		},
		{
			"name": "play stop",
			"l2": {
				"initCodeExec": [
					"sound.system(-1);\n"
				],
				"statement": "sound.play(-1);\n"
			}
		},
		{
			"name": "set state",
			"l2": {
				"initVarDecl": [
					[
						"// variables for state\n",
						"bool state[4];\n"
					]
				],
				"initCodeExec": [
					"state = [false, false, false, false];\n"
				],
				"initCodeDecl": [
					[
						"// display the current state\n",
						"void display_state() {\n",
						"leds.circle(0,state[1]?32:0,0,state[3]?32:0,0,state[2]?32:0,0,state[0]?32:0);\n",
						"}\n"
					]
				],
				"statement": [
					"`$.map(function (v, i) { return v ? 'state[' + i + '] = ' + (v > 0 ? 'true' : 'false') + ';\\n' : ''; }).join('')`",
					"`$[0] || $[1] || $[2] || $[3] ? 'display_state();\\n' : ''`"
				]
			}
		},
		{
			"name": "toggle state",
			"l2": {
				"initVarDecl": [
					[
						"// variables for state\n",
						"bool state[4];\n"
					]
				],
				"initCodeExec": [
					"state = [false, false, false, false];\n"
				],
				"initCodeDecl": [
					[
						"// display the current state\n",
						"void display_state() {\n",
						"leds.circle(0,state[1]?32:0,0,state[3]?32:0,0,state[2]?32:0,0,state[0]?32:0);\n",
						"}\n"
					]
				],
				"statement": [
					"`$.map(function (v, i) { return v ? 'state[' + i + '] = !state[' + i + '];\\n' : ''; }).join('')`",
					"`$[0] || $[1] || $[2] || $[3] ? 'display_state();\\n' : ''`"
				]
			}
		},
		{
			"name": "set state 8",
			"l2": {
				"initVarDecl": [
					[
						"// variables for exclusive state\n",
						"int state8;\n"
					]
				],
				"initCodeExec": [
					"state8 = 0;\n"
				],
				"initCodeDecl": [
					[
						"// display the current exclusive state\n",
						"void display_state8() {\n",
						"leds.circle(state8==0?32:0, state8==1?32:0, state8==2?32:0, state8==3?32:0, ",
							"state8==4?32:0, state8==5?32:0, state8==6?32:0, state8==7?32:0);\n",
						"}\n"
					]
				],
				"statement": [
					"state8 = `$[0]`;\n",
					"display_state8();\n"
				],
				"statementWithoutInit": [
					"leds.circle(`$[0] === 0 ? 32 : 0`, `$[0] === 1 ? 32 : 0`, `$[0] === 2 ? 32 : 0`, `$[0] === 3 ? 32 : 0`, ",
						"`$[0] === 4 ? 32 : 0`, `$[0] === 5 ? 32 : 0`, `$[0] === 6 ? 32 : 0`, `$[0] === 7 ? 32 : 0`);\n"
				]
			}
		},
		{
			"name": "change state 8",
			"l2": {
				"initVarDecl": [
					[
						"// variables for exclusive state\n",
						"int state8;\n"
					]
				],
				"initCodeExec": [
					"state8 = 0;\n"
				],
				"initCodeDecl": [
					[
						"// display the current exclusive state\n",
						"void display_state8() {\n",
						"leds.circle(state8==0?32:0, state8==1?32:0, state8==2?32:0, state8==3?32:0, ",
							"state8==4?32:0, state8==5?32:0, state8==6?32:0, state8==7?32:0);\n",
						"}\n"
					]
				],
				"statement": [
					"state8 = (state8 + `$[0] > 0 ? 1 : 7`) % 8;\n",
					"display_state8();\n"
				],
				"statementWithoutInit": [
					"leds.circle(`$[0] === 0 ? 32 : 0`, `$[0] === 1 ? 32 : 0`, `$[0] === 2 ? 32 : 0`, `$[0] === 3 ? 32 : 0`, ",
						"`$[0] === 4 ? 32 : 0`, `$[0] === 5 ? 32 : 0`, `$[0] === 6 ? 32 : 0`, `$[0] === 7 ? 32 : 0`);\n"
				]
			}
		},
		{
			"name": "set counter",
			"l2": {
				"initVarDecl": [
					"int counter;\n"
				],
				"initCodeExec": [
					"counter = 0;\n"
				],
				"initCodeDecl": [
					[
						"// display the current counter\n",
						"void display_counter(int c) {\n",
						"leds.circle((c&1)<<5,(c&2)<<4,(c&4)<<3,(c&8)<<2,\n",
						"(c&16)<<1,c&32,(c&64)>>1,(c&128)>>2);\n",
						"}\n"
					]
				],
				"statement": [
					"`$[0] === 0 ? 'counter = 0;' : $[0] > 0 ? 'if (counter < 255) {\\ncounter++;\\n}' : 'if (counter > 0) {\\ncounter--;\\n}'`\n",
					"display_counter(counter);\n"
				]
			}
		},
		{
			"name": "set timer",
			"l2": {
				"initVarDecl": [
					"bool timerElapsed;\n"
				],
				"initCodeExec": [
					[
						"// stop timer 0\n",
						"timer.period[0] = 0;\n"
					],
					"timerElapsed = false;\n"
				],
				"statement": "timer.period[0] = `Math.round(1000 * $[0])`;\n"
			}
		},
		{
			"name": "set timer log",
			"l2": {
				"initVarDecl": [
					"bool timerElapsed;\n"
				],
				"initCodeExec": [
					[
						"// stop timer 0\n",
						"timer.period[0] = 0;\n"
					],
					"timerElapsed = false;\n"
				],
				"statement": "timer.period[0] = `Math.round(1000 * $[0])`;\n"
			}
		},
		{
			"name": "picture comment",
			"l2": {}
		}
	]
}
</script>

<script type="application/json" id="js.json">
{
	"blocks": [
		{
			"name": "!stop",
			"js": {
				"statement": [
					"this.set(\"motor.left\", 0);\n",
					"this.set(\"motor.right\", 0);\n"
				]
			}
		},
		{
			"name": "button",
			"js": {
				"sectionBegin": "this.addEventListener(\"buttons\", function (name, param) {\n",
				"sectionEnd": "});\n",
				"clause": "`['center', 'forward', 'backward', 'right', 'left'].map(function (s, i) { return $[i] ? 'this.get(\"button.' + s + '\")' : ''; }).filter(function (s) { return s; }).join(' && ') || ['center', 'forward', 'backward', 'right', 'left'].map(function (s) { return 'this.get(\"button.' + s + '\")'; }).join(' || ')`"
			}
		},
		{
			"name": "button 1",
			"js": {
				"sectionBegin": "this.addEventListener(\"buttons\", function (name, param) {\n",
				"sectionEnd": "});\n",
				"clause": "this.get(\"button.`['center', 'forward', 'backward', 'right', 'left'][$[0]]`\")"
			}
		},
		{
			"name": "horiz prox",
			"js": {
				"sectionBegin": "this.addEventListener(\"prox\", function (name, param) {\n",
				"sectionEnd": "});\n",
				"clause": "`[2, 1, 3, 0, 4, 5, 6].map(function (ix, i) { return $[i] ? 'this.get(\"prox.horizontal\")[' + ix + '] ' + ($[i] > 0 ? '>' : '<') + '= 0.5' : ''; }).filter(function (s) { return s; }).join(' || ')`"
			}
		},
		{
			"name": "horiz prox adv",
			"js": {
				"sectionBegin": "this.addEventListener(\"prox\", function (name, param) {\n",
				"sectionEnd": "});\n",
				"clause": "`[2, 1, 3, 0, 4, 5, 6].map(function (ix, i) { return $[i] ? 'this.get(\"prox.horizontal\")[' + ix + '] ' + ($[i] > 0 ? '>= ' + toFixed($[7]) : '<= ' + toFixed($[8])) : ''; }).filter(function (s) { return s; }).join(' && ') || [2, 1, 3, 0, 4, 5, 6].map(function (ix) { return 'this.get(\"prox.horizontal\")[' + ix + '] ' + ($[i] > 0 ? '>= ' + toFixed($[7]) : '<= ' + toFixed($[8])); }).join(' || ')`"
			}
		},
		{
			"name": "horiz prox 1",
			"js": {
				"sectionBegin": "this.addEventListener(\"prox\", function (name, param) {\n",
				"sectionEnd": "});\n",
				"clause": "`[2, 1, 3, 0, 4, 5, 6].map(function (ix, i) { return $[i] ? 'this.get(\"prox.horizontal\")[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + toFixed($[7]) : ''; }).filter(function (s) { return s; }).join(' && ') || [2, 1, 3, 0, 4, 5, 6].map(function (ix) { return 'this.get(\"prox.horizontal\")[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + toFixed($[7]); }).join(' || ')`"
			}
		},
		{
			"name": "ground",
			"js": {
				"sectionBegin": "this.addEventListener(\"prox\", function (name, param) {\n",
				"sectionEnd": "});\n",
				"clause": "`[0, 1].map(function (ix, i) { return $[i] ? 'this.get(\"prox.ground.delta\")[' + ix + '] ' + ($[i] > 0 ? '>' : '<') + '= 0.5' : ''; }).filter(function (s) { return s; }).join(' || ')`"
			}
		},
		{
			"name": "ground adv",
			"js": {
				"sectionBegin": "this.addEventListener(\"prox\", function (name, param) {\n",
				"sectionEnd": "});\n",
				"clause": "`[0, 1].map(function (ix, i) { return $[i] ? 'this.get(\"prox.ground.delta\")[' + ix + '] ' + ($[i] > 0 ? '>= ' + toFixed($[2]) : '<= ' + toFixed($[3])) : ''; }).filter(function (s) { return s; }).join(' && ') || [0, 1].map(function (ix) { return 'this.get(\"prox.ground.delta\")[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + toFixed($[2]); }).join(' || ')`"
			}
		},
		{
			"name": "ground 1",
			"js": {
				"sectionBegin": "this.addEventListener(\"prox\", function (name, param) {\n",
				"sectionEnd": "});\n",
				"clause": "`[0, 1].map(function (ix, i) { return $[i] ? 'this.get(\"prox.ground.delta\")[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + toFixed($[2]) : ''; }).filter(function (s) { return s; }).join(' && ') || [0, 1].map(function (ix) { return 'this.get(\"prox.ground.delta\")[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + toFixed($[2]); }).join(' || ')`"
			}
		},
		{
			"name": "tap",
			"js": {
				"sectionBegin": "this.addEventListener(\"tap\", function (name, param) {\n",
				"sectionEnd": "});\n"
			}
		},
		{
			"name": "accelerometer",
			"js": {
				"initVarDecl": [
					"`$[0] == 0 ? 'bool tapped;\\n' : ''`"
				],
				"initCodeExec": [
					"`$[0] == 0 ? 'tapped = false;\\n' : ''`"
				],
				"sectionBegin": "this.addEventListener($[0] == 0 ? \"tap\" : \"acc\", function (name, param) {\n",
				"sectionEnd": "}\n",
				"sectionPreamble": "`$[0] == 0 ? 'tapped = true;\\n' : ''`",
				"clauseInit": "`$[0] === 1 ? 'var rollAngle = Math.atan2(acc[0], acc[2]);\\n' : $[0] === 2 ? 'var pitchAngle = Math.atan2(acc[1], acc[2]);\\n' : ''`",
				"clause": "`$[0] == 0 ? 'tapped' : (function (name, a) { return a <= -6 ? name + ' < ' + (Math.PI / 12 * (a + 0.5)).toFixed(2) : a >= 6 ? name + ' >= ' + (Math.PI / 12 * (a - 0.5)).toFixed(2) : name + ' >= ' + (Math.PI / 12 * (a - 0.5)).toFixed(2) + ' && ' + name + ' < ' + (Math.PI / 12 * (a + 0.5)).toFixed(2); })($[0] === 1 ? 'rollAngle' : 'pitchAngle', $[0] === 2 ? $[1] : -$[1])`"
			}
		},
		{
			"name": "roll",
			"js": {
				"sectionBegin": "this.addEventListener(\"acc\", function (name, param) {\n",
				"sectionEnd": "});\n",
				"clauseInit":
					"var rollAngle = Math.atan2(acc[0], acc[2]);\n",
				"clause":
					"rollAngle >= `toFixed(Math.PI / 12 * ($[0] - 0.5))` && rollAngle < `toFixed(Math.PI / 12 * ($[0] + 0.5))`"
			}
		},
		{
			"name": "pitch",
			"js": {
				"sectionBegin": "this.addEventListener(\"acc\", function (name, param) {\n",
				"sectionEnd": "});\n",
				"clauseInit":
					"var pitchAngle = Math.atan2(acc[1], acc[2]);\n",
				"clause":
					"pitchAngle >= `toFixed(Math.PI / 12 * (a - 0.5))` && pitchAngle < `toFixed(Math.PI / 12 * (a + 0.5))`"
			}
		},
		{
			"name": "yaw",
			"js": {
				"sectionBegin": "this.addEventListener(\"acc\", function (name, param) {\n",
				"sectionEnd": "});\n",
				"clauseInit":
					"var yawAngle = Math.atan2(acc[0], acc[1]);\n",
				"clause":
					"yawAngle >= `toFixed(Math.PI / 12 * (a - 0.5))` && yawAngle < `toFixed(Math.PI / 12 * (a + 0.5))`"
			}
		},
		{
			"name": "clap",
			"js": {
				"sectionBegin": "this.addEventListener(\"mic\", function (name, param) {\n",
				"sectionEnd": "});\n"
			}
		},
		{
			"name": "init",
			"js": {
				"sectionBegin": "// init block\n"
			}
		},
		{
			"name": "timer",
			"js": {
				"initCodeExec": [
					[
						"// stop timer 0\n",
						"this.setTimer(0, -1);\n"
					]
				],
				"sectionBegin": "this.addEventListener(\"timer0\", function (name, param) {\n",
				"sectionEnd": "});\n"
			}
		},
		{
			"name": "state",
			"js": {
				"initVarDecl": [
					[
						"// variables for state\n",
						"this.setClientState(\"state\", []);\n"
					]
				],
				"initCodeExec": [
					"this.setClientState(\"state\", [false, false, false, false]);\n"
				],
				"clauseInit": "var state0 = this.getClientState(\"state\");\n",
				"clause": "`$.map(function (v, i) { return (v >= 0 ? '' : '!') + 'state[' + i + ']'; }).filter(function (v, i) { return $[i]; }).join(' && ')`"
			}
		},
		{
			"name": "state 8",
			"js": {
				"initVarDecl": [
					[
						"// variable for exclusive state\n",
						"this.setClientState(\"state8\", 0);\n"
					]
				],
				"initCodeExec": [
					"this.setClientState(\"state8\", 0);\n"
				],
				"clauseInit": "var state80 = this.getClientState(\"state8\");\n",
				"clause": "state80 == `$[0].toString(10)`"
			}
		},
		{
			"name": "counter comparison",
			"js": {
				"initVarDecl": [
					[
						"// variable for counter\n",
						"this.setClientState(\"counter\", 0);\n"
					]
				],
				"initCodeExec": [
					"this.setClientState(\"counter\", 0);\n"
				],
				"clauseInit": "var counter0 = this.getClientState(\"counter\");\n",
				"clause": "counter0 `$[0] === 0 ? '==' : $[0] > 0 ? '>=' : '<='` `$[1]`"
			}
		},
		{
			"name": "color state",
			"js": {
				"clause": "`$.map(function (p, i) { return 'topColor[' + i + '] / 11 == ' + Math.floor(p * 2.99); }).join(' && ')`"
			}
		},
		{
			"name": "color 8 state",
			"js": {
				"clause": "`$.map(function (p, i) { return 'topColor[' + i + '] / 11 == ' + Math.floor(p * 2.99); }).join(' && ')`"
			}
		},
		{
			"name": "motor state",
			"js": {
				"clause": [
					"`$[0] == 0 ? 'Math.abs(' : ''`this.get(\"motor.left\")`$[0] > 0 ? ' > ' : $[0] < 0 ? ' < -' : ') < '`0.1 ",
					"&& `$[1] == 0 ? 'Math.abs(' : ''`this.get(\"motor.right\")`$[1] > 0 ? ' > ' : $[1] < 0 ? ' < -' : ') < '`0.1"
				]
			}
		},
		{
			"name": "motor",
			"js": {
				"initCodeExec": [
					"this.set(\"leds.top\", [0, 0, 0]);\n"
				],
				"statement": [
					"this.set(\"motor.left\", `toFixed($[0])`);\n",
					"this.set(\"motor.right\", `toFixed($[1])`);\n"
				]
			}
		},
		{
			"name": "move",
			"js": {
				"initCodeExec": [
					"this.set(\"leds.top\", [0, 0, 0]);\n"
				],
				"statement": [
					"this.set(\"motor.left\", `toFixed([0, 0.2, -0.2, 0.2-0.05, 0.2+0.05, -0.2, 0.2][$[0]])`);\n",
					"this.set(\"motor.right\", `toFixed([0, 0.2, -0.2, 0.2+0.05, 0.2-0.05, 0.2, -0.2][$[0]])`);\n"
				]
			}
		},
		{
			"name": "top color",
			"js": {
				"initCodeExec": [
					"this.set(\"leds.top\", [0, 0, 0]);\n"
				],
				"statement":
					"this.set(\"leds.top\", [`$.map(toFixed).join(', ')`]);\n"
			}
		},
		{
			"name": "top color 8",
			"js": {
				"initCodeExec": [
					"this.set(\"leds.top\", [0, 0, 0]);\n"
				],
				"statement":
					"this.set(\"leds.top\", [`['0,0,0','1,0,0','0,1,0','1,1,0','0,0,1','1,0,1','0,1,1','1,1,1'][$[0]]`]);\n"
			}
		},
		{
			"name": "bottom color",
			"js": {
				"initCodeExec": [
					"this.set(\"leds.top\", [0, 0, 0]);\n"
				],
				"statement": [
					"this.set(\"leds.bottom.left\", [`$.map(toFixed).join(', ')`]);\n",
					"this.set(\"leds.bottom.right\", [`$.map(toFixed).join(', ')`]);\n"
				]
			}
		},
		{
			"name": "bottom-left color",
			"js": {
				"initCodeExec": [
					"this.set(\"leds.top\", [0, 0, 0]);\n"
				],
				"statement":
					"this.set(\"leds.bottom.left\", [`$.map(toFixed).join(', ')`]);\n"
			}
		},
		{
			"name": "bottom-right color",
			"js": {
				"initCodeExec": [
					"this.set(\"leds.top\", [0, 0, 0]);\n"
				],
				"statement":
					"this.set(\"leds.bottom.right\", [`$.map(toFixed).join(', ')`]);\n"
			}
		},
		{
			"name": "bottom color 8",
			"js": {
				"initCodeExec": [
					"this.set(\"leds.top\", [0, 0, 0]);\n"
				],
				"statement": [
					"this.set(\"leds.bottom.left\", [`['0,0,0','1,0,0','0,1,0','1,1,0','0,0,1','1,0,1','0,1,1','1,1,1'][$[0]]`]);\n",
					"this.set(\"leds.bottom.right\", [`['0,0,0','1,0,0','0,1,0','1,1,0','0,0,1','1,0,1','0,1,1','1,1,1'][$[0]]`]);\n"
				]
			}
		},
		{
			"name": "bottom-left color 8",
			"js": {
				"initCodeExec": [
					"this.set(\"leds.top\", [0, 0, 0]);\n"
				],
				"statement":
					"this.set(\"leds.bottom.left\", [`['0,0,0','1,0,0','0,1,0','1,1,0','0,0,1','1,0,1','0,1,1','1,1,1'][$[0]]`]);\n"
			}
		},
		{
			"name": "bottom-right color 8",
			"js": {
				"initCodeExec": [
					"this.set(\"leds.top\", [0, 0, 0]);\n"
				],
				"statement":
					"this.set(\"leds.bottom.right\", [`['0,0,0','1,0,0','0,1,0','1,1,0','0,0,1','1,0,1','0,1,1','1,1,1'][$[0]]`]);\n"
			}
		},
		{
			"name": "notes",
			"js": {
				"initCodeExec": [
					[
						"// init notes\n",
						"this.set(\"sound\", {});\n"
					],
					"this.set(\"leds.top\", [0, 0, 0]);\n"
				],
				"statement":
					"this.set(\"sound\", {\"f\": [`$.filter(function (a, i) { return i % 2 == 0; }).map(function (h, i) { return $[2 * i + 1] ? [262, 311, 370, 440, 524, 370][h] : 0; }).join(', ')`], \"d\": [`$.filter(function (a, i) { return i % 2 == 1; }).map(function (d) { return d ? 7 * d : 28; }).join(', ')`]});\n"
			}
		},
		{
			"name": "play",
			"js": {
				"initCodeExec": [
					"// init notes\nthis.set(\"sound\", {});\n"
				],
				"statement": "this.set(\"sound\", {\"pcm\": `$[0].toString(10)`});\n"
			}
		},
		{
			"name": "play stop",
			"js": {
				"initCodeExec": [
					"// init notes\nthis.set(\"sound\", {});\n"
				],
				"statement": "this.set(\"sound\", {});\n"
			}
		},
		{
			"name": "set state",
			"js": {
				"initVarDecl": [
					[
						"// variables for state\n",
						"this.setClientState(\"state\", []);\n"
					]
				],
				"initCodeExec": [
					"this.setClientState(\"state\", [false, false, false, false]);\n"
				],
				"statement": [
					"var state = this.getClientState(\"state\");\n",
					"`$.map(function (v, i) { return v ? 'state[' + i + '] = ' + (v > 0 ? 'true' : 'false') + ';\\n' : ''; }).join('')`",
					"this.setClientState(\"state\", state);\n",
					"`$[0] || $[1] || $[2] || $[3] ? 'this.set(\"leds.circle\", [0,state[1]?1:0,0,state[3]?1:0,0,state[2]?1:0,0,state[0]?1:0]);\\n' : ''`"
				]
			}
		},
		{
			"name": "toggle state",
			"js": {
				"initVarDecl": [
					[
						"// variables for state\n",
						"this.setClientState(\"state\", []);\n"
					]
				],
				"initCodeExec": [
					"this.setClientState(\"state\", [false, false, false, false]);\n"
				],
				"statement": [
					"var state = this.getClientState(\"state\");\n",
					"`$.map(function (v, i) { return v ? 'state[' + i + '] = !state[' + i + '];\\n' : ''; }).join('')`",
					"this.setClientState(\"state\", state);\n",
					"`$[0] || $[1] || $[2] || $[3] ? 'this.set(\"leds.circle\", [0,state[1]?1:0,0,state[3]?1:0,0,state[2]?1:0,0,state[0]?1:0]);\\n' : ''`"
				]
			}
		},
		{
			"name": "set state 8",
			"js": {
				"initVarDecl": [
					[
						"// variable for exclusive state\n",
						"this.setClientState(\"state8\", 0);\n"
					]
				],
				"initCodeExec": [
					"this.setClientState(\"state8\", 0);\n"
				],
				"statement": [
					"this.setClientState(\"state8\", `$[0].toString(10)`);\n",
					"this.set(\"leds.circle\", [`[0,1,2,3,4,5,6,7].map(function (i) { return $[0] === i; }).join(', ')`]);\n"
				],
				"statementWithoutInit":
					"this.set(\"leds.circle\", [`[0,1,2,3,4,5,6,7].map(function (i) { return $[0] === i; }).join(', ')`]);\n"
			}
		},
		{
			"name": "change state 8",
			"js": {
				"initVarDecl": [
					[
						"// variable for exclusive state\n",
						"this.setClientState(\"state8\", 0);\n"
					]
				],
				"initCodeExec": [
					"this.setClientState(\"state8\", 0);\n"
				],
				"statement": [
					"var state8 = (this.getClientState(\"state8\") + `$[0] > 0 ? 1 : 7`) % 8;",
					"this.setClientState(\"state8\", state8);\n",
					"this.set(\"leds.circle\", [`[0,1,2,3,4,5,6,7].map(function (i) { return 'state8 === ' + i.toString(10); }).join(', ')`]);\n"
				],
				"statementWithoutInit":
					"this.set(\"leds.circle\", [`$[0] === 0 ? 1 : 0`,`$[0] === 1 ? 1 : 0`,`$[0] === 2 ? 1 : 0`,`$[0] === 3 ? 1 : 0`,`$[0] === 4 ? 1 : 0`,`$[0] === 5 ? 1 : 0`,`$[0] === 6 ? 1 : 0`,`$[0] === 7 ? 1 : 0`]);\n"
			}
		},
		{
			"name": "set counter",
			"js": {
				"initVarDecl": [
					[
						"// variable for counter\n",
						"this.setClientState(\"counter\", 0);\n"
					]
				],
				"initCodeExec": [
					"this.setClientState(\"counter\", 0);\n"
				],
				"statement": [
					"var counter = `$[0] === 0 ? 0 : $[0] > 0 ? 'Math.min(this.getClientState(\"counter\") + 1, 255)' : 'Math.max(this.getClientState(\"counter\") - 1, 0)'`;\n",
					"this.setClientState(\"counter\", counter);\n",
					"this.set(\"leds.circle\", [counter&1?1:0,counter&2?1:0,counter&4?1:0,counter&8?1:0,counter&16?1:0,counter&32?1:0,counter&64?1:0,counter&128?1:0]);\n"
				]
			}
		},
		{
			"name": "set timer",
			"js": {
				"initCodeExec": [
					[
						"// stop timer 0\n",
						"this.setTimer(0, -1);\n"
					]
				],
				"statement": "this.setTimer(0, `$[0].toFixed(3)`);\n"
			}
		},
		{
			"name": "set timer log",
			"js": {
				"initCodeExec": [
					[
						"// stop timer 0\n",
						"this.setTimer(0, -1);\n"
					]
				],
				"statement": "this.setTimer(0, `$[0].toFixed(3)`);\n"
			}
		},
		{
			"name": "picture comment",
			"js": {}
		}
	]
}
</script>

<script type="application/json" id="python.json">
{
	"blocks": [
		{
			"name": "!stop",
			"python": {
				"statement": [
					"self.set(\"motor.left\", 0)\n",
					"self.set(\"motor.right\", 0)\n"
				]
			}
		},
		{
			"name": "button",
			"python": {
				"sectionBegin": "def event_buttons(self):\n",
				"sectionEnd": "<\n",
				"clause": "`['center', 'forward', 'backward', 'right', 'left'].map(function (s, i) { return $[i] ? 'self.get(\"button.' + s + '\")' : ''; }).filter(function (s) { return s; }).join(' and ') || ['center', 'forward', 'backward', 'right', 'left'].map(function (s) { return 'self.get(\"button.' + s + '\")'; }).join(' or ')`"
			}
		},
		{
			"name": "button 1",
			"python": {
				"sectionBegin": "def event_buttons(self):\n",
				"sectionEnd": "<\n",
				"clause": "self.get(\"button.`['center', 'forward', 'backward', 'right', 'left'][$[0]]`\")"
			}
		},
		{
			"name": "horiz prox",
			"python": {
				"sectionBegin": "def event_prox(self):\n",
				"sectionEnd": "<\n",
				"clause": "`[2, 1, 3, 0, 4, 5, 6].map(function (ix, i) { return $[i] ? 'self.get(\"prox.horizontal\")[' + ix + '] ' + ($[i] > 0 ? '>' : '<') + '= 0.5' : ''; }).filter(function (s) { return s; }).join(' or ')`"
			}
		},
		{
			"name": "horiz prox adv",
			"python": {
				"sectionBegin": "def event_prox(self):\n",
				"sectionEnd": "<\n",
				"clause": "`[2, 1, 3, 0, 4, 5, 6].map(function (ix, i) { return $[i] ? 'self.get(\"prox.horizontal\")[' + ix + '] ' + ($[i] > 0 ? '>= ' + toFixed($[7]) : '<= ' + toFixed($[8])) : ''; }).filter(function (s) { return s; }).join(' and ') || [2, 1, 3, 0, 4, 5, 6].map(function (ix) { return 'self.get(\"prox.horizontal\")[' + ix + '] ' + ($[i] > 0 ? '>= ' + toFixed($[7]) : '<= ' + toFixed($[8])); }).join(' or ')`"
			}
		},
		{
			"name": "horiz prox 1",
			"python": {
				"sectionBegin": "def event_prox(self):\n",
				"sectionEnd": "<\n",
				"clause": "`[2, 1, 3, 0, 4, 5, 6].map(function (ix, i) { return $[i] ? 'self.get(\"prox.horizontal\")[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + toFixed($[7]) : ''; }).filter(function (s) { return s; }).join(' and ') || [2, 1, 3, 0, 4, 5, 6].map(function (ix) { return 'self.get(\"prox.horizontal\")[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + toFixed($[7]); }).join(' or ')`"
			}
		},
		{
			"name": "ground",
			"python": {
				"sectionBegin": "def event_prox(self):\n",
				"sectionEnd": "<\n",
				"clause": "`[0, 1].map(function (ix, i) { return $[i] ? 'self.get(\"prox.ground.delta\")[' + ix + '] ' + ($[i] > 0 ? '>' : '<') + '= 0.5' : ''; }).filter(function (s) { return s; }).join(' or ')`"
			}
		},
		{
			"name": "ground adv",
			"python": {
				"sectionBegin": "def event_prox(self):\n",
				"sectionEnd": "<\n",
				"clause": "`[0, 1].map(function (ix, i) { return $[i] ? 'self.get(\"prox.ground.delta\")[' + ix + '] ' + ($[i] > 0 ? '>= ' + toFixed($[2]) : '<= ' + toFixed($[3])) : ''; }).filter(function (s) { return s; }).join(' and ') || [0, 1].map(function (ix) { return 'self.get(\"prox.ground.delta\")[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + toFixed($[2]); }).join(' or ')`"
			}
		},
		{
			"name": "ground 1",
			"python": {
				"sectionBegin": "def event_prox(self):\n",
				"sectionEnd": "<\n",
				"clause": "`[0, 1].map(function (ix, i) { return $[i] ? 'self.get(\"prox.ground.delta\")[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + toFixed($[2]) : ''; }).filter(function (s) { return s; }).join(' and ') || [0, 1].map(function (ix) { return 'self.get(\"prox.ground.delta\")[' + ix + '] ' + ($[i] > 0 ? '>= ' : '<= ') + toFixed($[2]); }).join(' or ')`"
			}
		},
		{
			"name": "tap",
			"python": {
				"sectionBegin": "def event_tap(self):\n",
				"sectionEnd": "<\n"
			}
		},
		{
			"name": "accelerometer",
			"python": {
				"initCodeExec": [
					"`$[0] == 0 ? 'tapped = False\\n' : ''`"
				],
				"sectionBegin": "def event_acc(self):\n",
				"sectionEnd": "<\n",
				"sectionPreamble": "`$[0] == 0 ? 'tapped = True\\n' : ''`",
				"clauseInit": "`$[0] === 1 ? 'rollAngle = math.atan2(acc[0], acc[2]);\\n' : $[0] === 2 ? 'pitchAngle = math.atan2(acc[1], acc[2]);\\n' : ''`",
				"clause": "`$[0] == 0 ? 'tapped' : (function (name, a) { return a <= -6 ? name + ' < ' + (Math.PI / 12 * (a + 0.5)).toFixed(2) : a >= 6 ? name + ' >= ' + (Math.PI / 12 * (a - 0.5)).toFixed(2) : name + ' >= ' + (Math.PI / 12 * (a - 0.5)).toFixed(2) + ' && ' + name + ' < ' + (Math.PI / 12 * (a + 0.5)).toFixed(2); })($[0] === 1 ? 'rollAngle' : 'pitchAngle', $[0] === 2 ? $[1] : -$[1])`"
			}
		},
		{
			"name": "roll",
			"python": {
				"sectionBegin": "def event_acc(self):\n",
				"sectionEnd": "<\n",
				"clauseInit":
					"rollAngle = math.atan2(acc[0], acc[2])\n",
				"clause":
					"rollAngle >= `toFixed2(Math.PI / 12 * ($[0] - 0.5))` and rollAngle < `toFixed2(Math.PI / 12 * ($[0] + 0.5))`"
			}
		},
		{
			"name": "pitch",
			"python": {
				"sectionBegin": "def event_acc(self):\n",
				"sectionEnd": "<\n",
				"clauseInit":
					"pitchAngle = math.atan2(acc[1], acc[2])\n",
				"clause":
					"pitchAngle >= `toFixed2(Math.PI / 12 * (-$[0] - 0.5))` and pitchAngle < `toFixed2(Math.PI / 12 * ($[0] + 0.5))`"
			}
		},
		{
			"name": "yaw",
			"python": {
				"sectionBegin": "def event_acc(self):\n",
				"sectionEnd": "<\n",
				"clauseInit":
					"yawAngle = math.atan2(acc[0], acc[1])\n",
				"clause":
					"yawAngle >= `toFixed2(Math.PI / 12 * ($[0] - 0.5))` and yawAngle < `toFixed2(Math.PI / 12 * ($[0] + 0.5))`"
			}
		},
		{
			"name": "clap",
			"python": {
				"sectionBegin": "def event_mic(self):\n",
				"sectionEnd": "<\n"
			}
		},
		{
			"name": "init",
			"python": {
					"sectionBegin": "# init block\n"
			}
		},
		{
			"name": "timer",
			"python": {
				"initCodeExec": [
					[
						"# stop timer 0\n",
						"self.setTimer(0, -1)\n"
					]
				],
				"sectionBegin": "def event_timer0(self):\n",
				"sectionEnd": "<\n"
			}
		},
		{
			"name": "state",
			"python": {
					"initVarDecl": [
						[
							"# variables for state\n",
							"self.setClientState(\"state\", [])\n"
						]
					],
					"initCodeExec": [
						"self.setClientState(\"state\", [False, False, False, False])\n"
					],
					"clauseInit": "state0 = self.getClientState(\"state\")\n",
					"clause": "`$.map(function (v, i) { return (v >= 0 ? '' : '!') + 'state0[' + i + ']'; }).filter(function (v, i) { return $[i]; }).join(' and ')`"
			}
		},
		{
			"name": "state 8",
			"python": {
				"initVarDecl": [
					[
						"# variable for exclusive state\n",
						"self.setClientState(\"state8\", 0)\n"
					]
				],
				"initCodeExec": [
					"self.setClientState(\"state8\", 0)\n"
				],
				"clauseInit": "state80 = self.getClientState(\"state8\")\n",
				"clause": "state80 == `$[0].toString(10)`"
			}
		},
		{
			"name": "counter comparison",
			"python": {
					"initVarDecl": [
						[
							"# variable for counter\n",
							"self.setClientState(\"counter\", 0)\n"
						]
					],
					"initCodeExec": [
						"self.setClientState(\"counter\", 0)\n"
					],
					"clauseInit": "counter0 = self.getClientState(\"counter\")\n",
					"clause": "counter0 `$[0] === 0 ? '==' : $[0] > 0 ? '>=' : '<='` `$[1]`"
			}
		},
		{
			"name": "color state",
			"python": {
				"clause": "`$.map(function (p, i) { return 'topColor[' + i + '] / 11 == ' + Math.floor(p * 2.99); }).join(' and ')`"
			}
		},
		{
			"name": "color 8 state",
			"python": {
				"clause": "`$.map(function (p, i) { return 'topColor[' + i + '] / 11 == ' + Math.floor(p * 2.99); }).join(' and ')`"
			}
		},
		{
			"name": "motor state",
			"python": {
				"clause": [
					"`$[0] == 0 ? 'abs(' : ''`this.get(\"motor.left\")`$[0] > 0 ? ' > ' : $[0] < 0 ? ' < -' : ') < '`0.1 ",
					"and `$[1] == 0 ? 'abs(' : ''`this.get(\"motor.right\")`$[1] > 0 ? ' > ' : $[1] < 0 ? ' < -' : ') < '`0.1"
				]
			}
		},
		{
			"name": "motor",
			"python": {
					"initCodeExec": [
						"self.set(\"leds.top\", [0, 0, 0])\n"
					],
				"statement": [
					"self.set(\"motor.left\", `toFixed($[0])`)\n",
					"self.set(\"motor.right\", `toFixed($[1])`)\n"
				]
			}
		},
		{
			"name": "move",
			"python": {
					"initCodeExec": [
						"self.set(\"leds.top\", [0, 0, 0])\n"
					],
				"statement": [
					"self.set(\"motor.left\", `toFixed([0, 0.2, -0.2, 0.2-0.05, 0.2+0.05, -0.2, 0.2][$[0]])`)\n",
					"self.set(\"motor.right\", `toFixed([0, 0.2, -0.2, 0.2+0.05, 0.2-0.05, 0.2, -0.2][$[0]])`)\n"
				]
			}
		},
		{
			"name": "top color",
			"python": {
				"initCodeExec": [
					"self.set(\"leds.top\", [0, 0, 0])\n"
				],
				"statement":
					"self.set(\"leds.top\", [`$.map(toFixed).join(', ')`])\n"
			}
		},
		{
			"name": "top color 8",
			"python": {
					"initCodeExec": [
						"self.set(\"leds.top\", [0, 0, 0])\n"
					],
					"statement":
						"self.set(\"leds.top\", [`['0,0,0','1,0,0','0,1,0','1,1,0','0,0,1','1,0,1','0,1,1','1,1,1'][$[0]]`])\n"
			}
		},
		{
			"name": "bottom color",
			"python": {
					"initCodeExec": [
						"self.set(\"leds.top\", [0, 0, 0])\n"
					],
				"statement": [
					"self.set(\"leds.bottom.left\", [`$.map(toFixed).join(', ')`])\n",
					"self.set(\"leds.bottom.right\", [`$.map(toFixed).join(', ')`])\n"
				]
			}
		},
		{
			"name": "bottom-left color",
			"python": {
				"initCodeExec": [
					"self.set(\"leds.top\", [0, 0, 0])\n"
				],
				"statement":
					"self.set(\"leds.bottom.left\", [`$.map(toFixed).join(', ')`])\n"
			}
		},
		{
			"name": "bottom-right color",
			"python": {
				"initCodeExec": [
					"self.set(\"leds.top\", [0, 0, 0])\n"
				],
				"statement":
					"self.set(\"leds.bottom.right\", [`$.map(toFixed).join(', ')`])\n"
			}
		},
		{
			"name": "bottom color 8",
			"python": {
				"initCodeExec": [
					"self.set(\"leds.top\", [0, 0, 0])\n"
				],
				"statement": [
					"self.set(\"leds.bottom.left\", [`['0,0,0','1,0,0','0,1,0','1,1,0','0,0,1','1,0,1','0,1,1','1,1,1'][$[0]]`])\n",
					"self.set(\"leds.bottom.right\", [`['0,0,0','1,0,0','0,1,0','1,1,0','0,0,1','1,0,1','0,1,1','1,1,1'][$[0]]`])\n"
				]
			}
		},
		{
			"name": "bottom-left color 8",
			"python": {
				"initCodeExec": [
					"self.set(\"leds.top\", [0, 0, 0])\n"
				],
				"statement":
					"self.set(\"leds.bottom.left\", [`['0,0,0','1,0,0','0,1,0','1,1,0','0,0,1','1,0,1','0,1,1','1,1,1'][$[0]]`])\n"
			}
		},
		{
			"name": "bottom-right color 8",
			"python": {
				"initCodeExec": [
					"self.set(\"leds.top\", [0, 0, 0])\n"
				],
				"statement":
					"self.set(\"leds.bottom.right\", [`['0,0,0','1,0,0','0,1,0','1,1,0','0,0,1','1,0,1','0,1,1','1,1,1'][$[0]]`])\n"
			}
		},
		{
			"name": "notes",
			"python": {
				"initCodeExec": [
					[
						"# init notes\n",
						"self.set(\"sound\", {})\n",
						"self.set(\"leds.top\", [0, 0, 0])\n"
					]
				],
				"statement":
					"self.set(\"sound\", {\"f\": [`$.filter(function (a, i) { return i % 2 == 0; }).map(function (h, i) { return $[2 * i + 1] ? [262, 311, 370, 440, 524, 370][h] : 0; }).join(', ')`], \"d\": [`$.filter(function (a, i) { return i % 2 == 1; }).map(function (d) { return d ? 7 * d : 28; }).join(', ')`]})\n"
			}
		},
		{
			"name": "play",
			"python": {
 				"initCodeExec": [
					"# init notes\nself.set(\"sound\", {})\n"
				],
				"statement": "self.set(\"sound\", {\"pcm\": `$[0]`})\n"
			}
		},
		{
			"name": "play stop",
			"python": {
 				"initCodeExec": [
					"# init notes\nself.set(\"sound\", {})\n"
				],
				"statement": "self.set(\"sound\", {})\n"
			}
		},
		{
			"name": "set state",
			"python": {
				"initVarDecl": [
					[
						"# variables for state\n",
						"self.setClientState(\"state\", [])\n"
					]
				],
				"initCodeExec": [
					"self.setClientState(\"state\", [False, False, False, False])\n"
				],
				"statement": [
					"state = this.getClientState(\"state\")\n",
					"`$.map(function (v, i) { return v ? 'state[' + i + '] = ' + (v > 0 ? 'True' : 'False') + '\\n' : ''; }).join('')`",
					"self.setClientState(\"state\", state)\n",
					"`$[0] || $[1] || $[2] || $[3] ? 'self.set(\"leds.circle\", [0,state[1]?1:0,0,state[3]?1:0,0,state[2]?1:0,0,state[0]?1:0])\\n' : ''`"
				]
			}
		},
		{
			"name": "toggle state",
			"python": {
				"initVarDecl": [
					[
						"# variables for state\n",
						"self.setClientState(\"state\", [])\n"
					]
				],
				"initCodeExec": [
					"self.setClientState(\"state\", [False, False, False, False])\n"
				],
				"statement": [
					"state = this.getClientState(\"state\")\n",
					"`$.map(function (v, i) { return v ? 'state[' + i + '] = !state[' + i + ']\\n' : ''; }).join('')`",
					"self.setClientState(\"state\", state)\n",
					"`$[0] || $[1] || $[2] || $[3] ? 'self.set(\"leds.circle\", [0,state[1]?1:0,0,state[3]?1:0,0,state[2]?1:0,0,state[0]?1:0])\\n' : ''`"
				]
			}
		},
		{
			"name": "set state 8",
			"python": {
					"initVarDecl": [
						[
							"# variable for exclusive state\n",
							"self.setClientState(\"state8\", 0)\n"
						]
					],
					"initCodeExec": [
						"self.setClientState(\"state8\", 0)\n"
					],
					"statement": [
						"self.setClientState(\"state8\", `$[0].toString(10)`)\n",
						"self.set(\"leds.circle\", [`[0,1,2,3,4,5,6,7].map(function (i) { return $[0] === i; }).join(', ')`])\n"
					],
					"statementWithoutInit":
						"self.set(\"leds.circle\", [`[0,1,2,3,4,5,6,7].map(function (i) { return $[0] === i; }).join(', ')`])\n"
			}
		},
		{
			"name": "change state 8",
			"python": {
					"initVarDecl": [
						[
							"# variable for exclusive state\n",
							"self.setClientState(\"state8\", 0)\n"
						]
					],
					"initCodeExec": [
						"self.setClientState(\"state8\", 0)\n"
					],
				"statement": [
					"state8 = (this.getClientState(\"state8\") + `$[0] > 0 ? 1 : 7`) % 8",
					"self.setClientState(\"state8\", state8)\n",
					"self.set(\"leds.circle\", [`[0,1,2,3,4,5,6,7].map(function (i) { return 'state8 === ' + i.toString(10); }).join(', ')`])\n"
				],
				"statementWithoutInit":
					"self.set(\"leds.circle\", [`$[0] === 0 ? 1 : 0`,`$[0] === 1 ? 1 : 0`,`$[0] === 2 ? 1 : 0`,`$[0] === 3 ? 1 : 0`,`$[0] === 4 ? 1 : 0`,`$[0] === 5 ? 1 : 0`,`$[0] === 6 ? 1 : 0`,`$[0] === 7 ? 1 : 0`])\n"
			}
		},
		{
			"name": "set counter",
			"python": {
					"initVarDecl": [
						[
							"# variable for counter\n",
							"self.setClientState(\"counter\", 0)\n"
						]
					],
					"initCodeExec": [
						"self.setClientState(\"counter\", 0)\n"
					],
				"statement": [
					"counter = `$[0] === 0 ? 0 : $[0] > 0 ? 'Math.min(this.getClientState(\"counter\") + 1, 255)' : 'Math.max(this.getClientState(\"counter\") - 1, 0)'`\n",
					"self.setClientState(\"counter\", counter)\n",
					"self.set(\"leds.circle\", [counter&1?1:0,counter&2?1:0,counter&4?1:0,counter&8?1:0,counter&16?1:0,counter&32?1:0,counter&64?1:0,counter&128?1:0])\n"
				]
			}
		},
		{
			"name": "set timer",
			"python": {
					"initCodeExec": [
						[
							"# stop timer 0\n",
							"self.setTimer(0, -1)\n"
						]
					],
					"statement": "self.setTimer(0, `$[0].toFixed(3)`)\n"
			}
		},
		{
			"name": "set timer log",
			"python": {
				"initCodeExec": [
					[
						"# stop timer 0\n",
						"self.setTimer(0, -1)\n"
					]
				],
				"statement": "self.setTimer(0, `$[0].toFixed(3)`)\n"
			}
		},
		{
			"name": "picture comment",
			"python": {}
		}
	]
}
</script>

<script type="application/json" id="french.json">
{
	"i18n": {
		"fr": {
			"Duplicate action blocks": "Un bloc d'action fait doublon",
			"Rules with same events": "Règles avec les mêmes événements",
			"Missing action block": "Il manque un bloc d'action",
			"Missing event block": "Il manque un bloc d'événement",
			"No button specified": "Aucun bouton n'est spécifié",
			"No ground sensor specified": "Aucun capteur de sol n'est spécifié",
			"No proximity sensor specified": "Aucun capteur de proximité n'est spécifié",
			"No sensor specified": "Aucun capteur n'est spécifié",
			"Open program file": "Ouvrir un programme",
			"OK": "OK",
			"Cancel": "Annuler"
		}
	}
}
</script>

<script type="application/json" id="typical-param-set.json">
{
	"blocks": [
		{
			"name": "accelerometer",
			"typicalParamSet": [
				[0, 0],
				[1, 2],
				[2, 2]
			]
		},
		{
			"name": "counter comparison",
			"typicalParamSet": [
				[-1, 2],
				[0, 9],
				[1, 3]
			]
		},
		{
			"name": "set counter",
			"typicalParamSet": [
				[-1],
				[0],
				[1]
			]
		}
	]
}
</script>

<script type="application/json" id="typical-states.json">
{
	"buttons": [
		{
			"name": "vpl:text-toggle",
			"typicalStates": [
				{"selected": false},
				{"selected": true}
			]
		}
	]
}
</script>

<script type="application/json" id="block-english.json">
{
	"i18n": {
		"en": {
			"button 1": "Single button",
			"button": "Multiple buttons",
			"horiz prox": "Proximity sensors",
			"horiz prox adv": "Proximity sensors with low and high thresholds",
			"horiz prox 1": "Proximity sensors with threshold",
			"ground": "Ground reflection sensors",
			"ground adv": "Ground reflection sensors with low and high sensors",
			"ground 1": "Ground reflection sensors with threshold",
			"tap": "Impact detection",
			"accelerometer": "Accelerometer",
			"roll": "Roll angle",
			"pitch": "Pitch angle",
			"yaw": "Yaw angle",
			"clap": "Sound detection",
			"init": "Initialization",
			"timer": "Timer elapsed",
			"state": "State (4 bits)",
			"state 8": "State (8 values)",
			"counter comparison": "Counter comparison",
			"color state": "Color state",
			"color 8 state": "Color state",
			"motor state": "Motor state",
			"motor": "Set motor speeds",
			"move": "Set motion",
			"nn obstacles": "Neural net for obstacle avoidance",
			"top color": "Set top color (RGB components)",
			"top color 8": "Set top color",
			"bottom color": "Set bottom color (RGB components)",
			"bottom-left color": "Set bottom-left color (RGB components)",
			"bottom-right color": "Set bottom-right color (RGB components)",
			"bottom color 8": "Set bottom color",
			"bottom-left color 8": "Set bottom-left color",
			"bottom-right color 8": "Set bottom-right color",
			"notes": "Play melody",
			"play": "Play a .wav file",
			"play stop": "Stop playing a .wav file",
			"set state": "Set state (4 bits)",
			"toggle state": "Toggle state (4 bits)",
			"set state 8": "Set state (8 values)",
			"change state 8": "Set to next or previous state (8 values)",
			"set counter": "Set counter",
			"set timer": "Start timer (0-4 sec)",
			"set timer log": "Set timer (0.1-10 sec)",
			"picture comment": "Picture comment"
		}
	}
}
</script>

<script type="application/json" id="cmd-vpl-english.json">
{
	"i18n": {
		"en": {
			"vpl:close": "Close panel",
			"vpl:about": "Show application information",
			"vpl:help": "Show documentation",
			"vpl:readonly": "Read-only program",
			"vpl:new": "New program",
			"vpl:save": "Save program",
			"vpl:load": "Load program",
			"vpl:upload": "Upload program",
			"vpl:exportToHTML": "Export program view to HTML",
			"vpl:text": "Text source code panel",
			"vpl:text-toggle": "Show or hide text source code panel",
			"vpl:advanced": "Switch advanced mode on or off",
			"vpl:undo": "Undo last program change",
			"vpl:redo": "Redo last undone program change",
			"vpl:run": "Run program",
			"vpl:stop": "Stop program",
			"vpl:connected": "Connection status",
			"vpl:robot": "Change robot",
			"vpl:sim": "Simulator panel",
			"vpl:duplicate": "Duplicate rule (rule drop target)",
			"vpl:disable": "Disable block or rule (drop target)",
			"vpl:lock": "Lock block or rule (drop target)",
			"vpl:trashcan": "Remove block or rule (drop target)",
			"vpl:message-error": "Error message",
			"vpl:message-warning": "Warning message",
			"vpl:message-empty": " ",
			"vpl:filename": "Filename",
			"vpl:teacher": "Switch customization mode on or off",
			"vpl:teacher-reset": "Reset customization",
			"vpl:teacher-save": "Save customization",
			"vpl:teacher-setasnew": "Install customization for new programs"
		}
	}
}
</script>

<script type="application/json" id="cmd-sim-english.json">
{
	"i18n": {
		"en": {
			"sim:close": "Close panel",
			"sim:restart": "Restart simulation",
			"sim:pause": "Pause simulation",
			"sim:speedup": "Set simulation speedup factor",
			"sim:noise": "Switch noise on sensors on or off",
			"sim:pen": "Switch pen on or off",
			"sim:clear": "Erase traces made by pen",
			"sim:map-kind": "Select which map is displayed (ground, height, obstacles)",
			"sim:map": "Switch map on or off",
			"sim:map-ground": "Switch ground map on or off",
			"sim:map-height": "Switch height map on or off",
			"sim:map-obstacles": "Switch obstacles map on or off",
			"sim:vpl": "VPL panel",
			"sim:text": "Text source code panel",
			"sim:teacher": "Switch customization mode on or off",
			"sim:teacher-reset": "Reset customization",
			"sim:btn-button.forward": "Simulate a touch on the forward button",
			"sim:btn-button.left": "Simulate a touch on the left button",
			"sim:btn-button.center": "Simulate a touch on the center button",
			"sim:btn-button.right": "Simulate a touch on the right button",
			"sim:btn-button.backward": "Simulate a touch on the backward button",
			"sim:btn-tap": "Simulate an impact detection",
			"sim:btn-clap": "Simulate a sound detection"
		}
	}
}
</script>

<script type="application/json" id="block-french.json">
{
	"i18n": {
		"fr": {
			"button 1": "Bouton simple",
			"button": "Boutons multiples",
			"horiz prox": "Capteurs de proximité",
			"horiz prox adv": "Capteurs de proximité avec seuils bas et haut",
			"horiz prox 1": "Capteurs de proximité avec seuil",
			"ground": "Capteurs de réflexion sur le sol",
			"ground adv": "Capteurs de réflexion sur le sol avec seuils bas et haut",
			"ground 1": "Capteurs de réflexion sur le sol avec seuil",
			"tap": "Détection de choc",
			"accelerometer": "Accéléromètre",
			"roll": "Angle de roulis",
			"pitch": "Angle de tangage",
			"yaw": "Angle de lacet",
			"clap": "Détection de son",
			"init": "Initialisation",
			"timer": "Minuterie",
			"state": "État (4 bits)",
			"state 8": "État (8 valeurs)",
			"counter comparison": "Comparaison du compteur",
			"color state": "État (couleur)",
			"color 8 state": "État (couleur)",
			"motor state": "Vitesses des moteurs",
			"motor": "Change les vitesses des moteurs",
			"move": "Change le type de déplacement",
			"nn obstacles": "Réseau de neurones pour l'évitement d'obstacles",
			"top color": "Change la couleur du dessus (composantes RVB)",
			"top color 8": "Change la couleur du dessus",
			"bottom color": "Change la couleur du dessous (composantes RVB)",
			"bottom-left color": "Change la couleur du dessous à gauche (composantes RVB)",
			"bottom-right color": "Change la couleur du dessous à droite (composantes RVB)",
			"bottom color 8": "Change la couleur du dessous",
			"bottom-left color 8": "Change la couleur du dessous à gauche",
			"bottom-right color 8": "Change la couleur du dessous à droite",
			"notes": "Joue une mélodie",
			"play": "Joue un fichier .wav",
			"play stop": "Arrête de jouer un fichier .wav",
			"set state": "Change l'état (4 bits)",
			"toggle state": "Inverse l'état (4 bits)",
			"set state 8": "Change l'état (8 valeurs)",
			"change state 8": "Passe à l'état suivant ou précédant (8 valeurs)",
			"set counter": "Change le compteur",
			"set timer": "Démarre la minuterie (0-4 sec)",
			"set timer log": "Démarre la minuterie (0.1-10 sec)",
			"picture comment": "Commentaire (image)"
		}
	}
}
</script>

<script type="application/json" id="cmd-vpl-french.json">
{
	"i18n": {
		"fr": {
			"vpl:close": "Ferme la vue",
			"vpl:about": "Affiche des informations sur l'application",
			"vpl:help": "Affiche la documentation",
			"vpl:readonly": "Programme en mode lecture seule",
			"vpl:new": "Nouveau programme",
			"vpl:save": "Enregistre le programme",
			"vpl:load": "Charge le programme",
			"vpl:upload": "Téléverse le programme",
			"vpl:exportToHTML": "Exporte le programme en HTML",
			"vpl:text": "Affiche le code source",
			"vpl:text-toggle": "Affiche ou cache la vue code source",
			"vpl:advanced": "Commute entre les modes de base et avancés",
			"vpl:undo": "Annule le dernier changement",
			"vpl:redo": "Rétablit le dernier changement annulé",
			"vpl:run": "Exécute le programme",
			"vpl:stop": "Arrête le programme",
			"vpl:connected": "Témoin de connexion",
			"vpl:robot": "Change de robot",
			"vpl:sim": "Affiche le simulateur",
			"vpl:duplicate": "Duplique une règle (cible de glisser/déposer)",
			"vpl:disable": "Désactive un bloc ou une règle (cible de glisser/déposer)",
			"vpl:lock": "Verrouille un bloc ou une règle (cible de glisser/déposer)",
			"vpl:trashcan": "Supprime un bloc ou une règle (cible de glisser/déposer)",
			"vpl:message-error": "Message d'erreur",
			"vpl:message-warning": "Message d'avertissement",
			"vpl:message-empty": " ",
			"vpl:filename": "Nom de fichier",
			"vpl:teacher": "Commute entre les modes de programmation et de configuration",
			"vpl:teacher-reset": "Remet la configuration à l'état d'origine",
			"vpl:teacher-save": "Enregistre la configuration",
			"vpl:teacher-setasnew": "Installe la configuration pour les nouveaux programmes"
		}
	}
}
</script>

<script type="application/json" id="cmd-sim-french.json">
{
	"i18n": {
		"fr": {
			"sim:close": "Ferme la vue",
			"sim:restart": "Redémarre la simulation depuis le début",
			"sim:pause": "Met la simulation en pause",
			"sim:speedup": "Change le facteur d'accélération de la simulation",
			"sim:noise": "Enclenche l'ajout de bruit sur les capteurs",
			"sim:pen": "Commute entre le crayon en position baissée ou levée",
			"sim:clear": "Efface les traces faites par le crayon",
			"sim:map-kind": "Change la carte affichée (sol, hauteur ou obstacles)",
			"sim:map": "Active ou désactive la carte",
			"sim:map-ground": "Active ou désactive la carte du sol",
			"sim:map-height": "Active ou désactive la carte de la hauteur",
			"sim:map-obstacles": "Active ou désactive la carte des obstacles",
			"sim:vpl": "Affiche le programme VPL",
			"sim:text": "Affiche le code source",
			"sim:teacher": "Commute entre les modes de programmation et de configuration",
			"sim:teacher-reset": "Remet la configuration à l'état d'origine",
			"sim:btn-button.forward": "Simule une pression sur le bouton avant",
			"sim:btn-button.left": "Simule une pression sur le bouton gauche",
			"sim:btn-button.center": "Simule une pression sur le bouton central",
			"sim:btn-button.right": "Simule une pression sur le bouton droit",
			"sim:btn-button.backward": "Simule une pression sur le bouton arrière",
			"sim:btn-tap": "Simule une détection de choc",
			"sim:btn-clap": "Simule une détection de bruit"
		}
	}
}
</script>

<title>VPL</title>

<style>
html {
	height: 100%;
}
body {
	height: 100%;
	margin: 0;
}
#programCanvas {
	width: 100%;
	height: 100%;
	display: block;
	z-index: 10;
}
#src-editor {
	width: 100%;
	position: fixed;
	z-index: 20;
}
#editor {
	height: 100%;
	display: block;
	padding-top: 0;
	padding-bottom: 0;
	padding-left: 5pt;
	padding-right: 5pt;
	margin: 0;
	border: 0;
	box-sizing: border-box;
	tab-size: 4;
	font-family: monospace;
	font-size: 11pt;
}
pre#editor-lines {
	background-color: silver;
    width: 70px;
    float: left;
    margin: 0;
    padding-top: 0;
    padding-bottom: 0;
    padding-left: 0;
    padding-right: 5pt;
    text-align: right;
    overflow: hidden;
	user-select: none;
}

#input {
	position: absolute;
	z-index: 1000;
	font-family: sans-serif;
	font-size: 15pt;
	top: 10px;
	left: 10px;
	display: none;
}

@media only screen and (max-device-width: 1024px) {
	#editor {
		tab-size: 2;
		font-size: 10pt;
	}
}
</style>

<script src="src/a3a-ns.js"></script>
<script src="src/svg.js"></script>
<script src="src/svg-preparsed.js"></script>
<script src="src/svg-transform.js"></script>
<script src="src/vpl-ns.js"></script>
<script src="src/vpl-blocktemplate.js"></script>
<script src="src/vpl-block.js"></script>
<script src="src/vpl-emptyblock.js"></script>
<script src="src/css.js"></script>
<script src="src/vpl-css.js"></script>
<script src="src/vpl-css-draw.js"></script>
<script src="src/vpl-canvas.js"></script>
<script src="src/vpl-canvas-scroll.js"></script>
<script src="src/vpl-blocklibutil.js"></script>
<script src="src/vpl-blocklib.js"></script>
<script src="src/vpl-blocklib-svg.js"></script>
<script src="src/vpl-jsoncode.js"></script>
<script src="src/vpl-rule.js"></script>
<script src="src/vpl-uiconfig.js"></script>
<script src="src/vpl-program.js"></script>
<script src="src/vpl-code.js"></script>
<script src="src/vpl-code-aseba.js"></script>
<script src="src/vpl-code-l2.js"></script>
<script src="src/vpl-code-js.js"></script>
<script src="src/vpl-code-python.js"></script>
<script src="src/vpl-cmd.js"></script>
<script src="src/vpl-app.js"></script>
<script src="src/vpl-ui-validator.js"></script>
<script src="src/vpl-cmd-vpl.js"></script>
<script src="src/vpl-controlbar.js"></script>
<script src="src/vpl-buttons-js.js"></script>
<script src="src/vpl-controlbar-btn.js"></script>
<script src="src/vpl-widgets-js.js"></script>
<script src="src/vpl-program-canvas.js"></script>
<script src="src/vpl-error.js"></script>
<script src="src/vpl-draw.js"></script>
<script src="src/vpl-undo.js"></script>
<script src="src/vpl-html.js"></script>
<script src="src/vpl-aeslfile.js"></script>
<script src="src/vpl-texteditor.js"></script>
<script src="src/vpl-sourceedit.js"></script>
<script src="src/vpl-cmd-src.js"></script>
<script src="src/vpl-ui-svg.js"></script>
<script src="src/vpl-runglue.js"></script>
<script src="src/vpl-htmlpanel.js"></script>
<script src="src/vpl-files.js"></script>
<script src="src/vpl-load.js"></script>
<script src="src/vpl-com.js"></script>
<script src="src/vpl-i18n.js"></script>
<script src="src/vpl-main.js"></script>

<script src="src/a3a-nodebase.js"></script>
<script src="src/a3a-nodeproxy.js"></script>

<script src="src/vpl-thymio.js"></script>
<script src="src/vpl-thymio-tdm.js"></script>
<script src="src/vpl-robot.js"></script>
<script src="src/vpl-virtualthymio.js"></script>
<script src="src/compiler-ns.js"></script>
<script src="src/compiler-vm.js"></script>
<script src="src/compiler-dis.js"></script>
<script src="src/compiler-dis-mixed.js"></script>
<script src="src/compiler.js"></script>
<script src="src/compiler-macros.js"></script>
<script src="src/compiler-l2.js"></script>
<script src="src/compiler-macros-l2.js"></script>
<script src="src/compiler-thymio.js"></script>
<script src="src/inputbuffer.js"></script>
<script src="src/a3a-idmapping.js"></script>
<script src="src/a3a-com.js"></script>
<script src="src/a3a-device.js"></script>
<script src="src/a3a-virtual-thymio.js"></script>
<script src="src/vpl-virtualthymio-a3a.js"></script>
<script src="src/vpl-obstacles.js"></script>
<script src="src/vpl-sim.js"></script>
<script src="src/vpl-sim2d.js"></script>
<script src="src/vpl-cmd-sim.js"></script>

<script src="thymio/thymio.js"></script>

</head>

<body>

<div id="vpl-editor">

<canvas id="programCanvas" width="900" height="700"></canvas>

<input id="input">

</div>

<div id="src-editor">
<pre id="editor-lines"></pre>
<textarea id="editor" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
</textarea>
</div>

</body>

</html>
